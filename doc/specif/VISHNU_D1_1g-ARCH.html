<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>D1.1g - VISHNU Technical Architecture</title><meta name="generator" content="DocBook XSL Stylesheets V1.75.2" /></head><body><div class="book" title="D1.1g - VISHNU Technical Architecture"><div class="titlepage"><div><div><h1 class="title"><a id="id3733016"></a>D1.1g - VISHNU Technical Architecture</h1></div><div><div class="author"><h3 class="author"><span class="firstname">Benjamin</span> <span class="surname">Isnard</span></h3></div></div><div><div class="author"><h3 class="author"><span class="firstname">Benjamin</span> <span class="surname">Depardon</span></h3></div></div><div><div class="author"><h3 class="author"><span class="firstname">Daouda</span> <span class="surname">Traore</span></h3></div></div><div><div class="author"><h3 class="author"><span class="firstname">Eugène</span> <span class="surname">Pamba Capo-Chichi</span></h3></div></div><div><div class="author"><h3 class="author"><span class="firstname">Ibrahima</span> <span class="surname">Cissé</span></h3></div></div><div><div class="author"><h3 class="author"><span class="firstname">Kevin</span> <span class="surname">Coulomb</span></h3></div></div><div><div class="revhistory"><table border="1" width="100%" summary="Revision history"><tr><th align="left" valign="top" colspan="3"><b>Revision History</b></th></tr><tr><td align="left">Revision 1</td><td align="left">08/02/2011</td><td align="left">SysFera</td></tr><tr><td align="left" colspan="3">
          <p>Deliverable version</p>
        </td></tr><tr><td align="left">Revision 2</td><td align="left">11/03/2011</td><td align="left">SysFera</td></tr><tr><td align="left" colspan="3">
          <p>Added chapter 5 for TMS and FMS details</p>
          <p>In §3.1, added definition for VISHNU machine</p>
          <p>In §3.4, modified flows VFT, UFT and DFT, and added CFT</p>
        </td></tr><tr><td align="left">Revision 3</td><td align="left">25/03/2011</td><td align="left">SysFera</td></tr><tr><td align="left" colspan="3">
          <p>In §3.4, added flows COS and OSS</p>
        </td></tr><tr><td align="left">Revision 4</td><td align="left">22/07/2011</td><td align="left">SysFera</td></tr><tr><td align="left" colspan="3">
          <p>Added SLURM</p>
        </td></tr><tr><td align="left">Revision 5</td><td align="left">07/12/2011</td><td align="left">SysFera</td></tr><tr><td align="left" colspan="3">
          <p> Added SLURMJobScheduler on Figure 3.3 and change of ORACLE to MYSQL on the document such as Figure 5.3 and Figure 5.6</p>
        </td></tr></table></div></div></div><hr /></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="chapter"><a href="#id3733268">1. Document presentation</a></span></dt><dd><dl><dt><span class="section"><a href="#id3733609">Document objectives</a></span></dt><dt><span class="section"><a href="#id3733627">Document structure</a></span></dt><dt><span class="section"><a href="#id3733682">References</a></span></dt><dt><span class="section"><a href="#id3733712">Acronyms and abbreviations</a></span></dt><dt><span class="section"><a href="#id3733893">Glossary</a></span></dt></dl></dd><dt><span class="chapter"><a href="#id3734040">2. Global description of VISHNU</a></span></dt><dd><dl><dt><span class="section"><a href="#id3734053">Project sheet</a></span></dt><dt><span class="section"><a href="#id3734473">QoS objectives</a></span></dt></dl></dd><dt><span class="chapter"><a href="#id3734567">3. Functional architecture</a></span></dt><dd><dl><dt><span class="section"><a href="#id3734575">VISHNU concepts</a></span></dt><dt><span class="section"><a href="#id3734846">Functional architecture diagram</a></span></dt><dt><span class="section"><a href="#id3734900">Database description</a></span></dt><dd><dl><dt><span class="section"><a href="#id3734906">Functional view</a></span></dt><dt><span class="section"><a href="#id3735003">Logical view</a></span></dt></dl></dd><dt><span class="section"><a href="#id3735041">Data flows</a></span></dt><dt><span class="section"><a href="#id3735713">Software architecture diagram</a></span></dt></dl></dd><dt><span class="chapter"><a href="#id3735870">4. Technical architecture</a></span></dt><dd><dl><dt><span class="section"><a href="#id3735885">Technical architecture diagram</a></span></dt><dt><span class="section"><a href="#id3735943">Technical architecture with network firewalls</a></span></dt></dl></dd><dt><span class="chapter"><a href="#id3736059">5. VISHNU modules architecture</a></span></dt><dd><dl><dt><span class="section"><a href="#id3736072">TMS module details</a></span></dt><dd><dl><dt><span class="section"><a href="#id3736085">TMS submit job call sequence </a></span></dt><dt><span class="section"><a href="#id3736260">TMS server deployment</a></span></dt></dl></dd><dt><span class="section"><a href="#id3736305">FMS module details</a></span></dt><dd><dl><dt><span class="section"><a href="#id3736319">FMS service call sequence</a></span></dt><dt><span class="section"><a href="#id3736550">FMS server deployment</a></span></dt></dl></dd></dl></dd></dl></div><div class="list-of-figures"><p><b>List of Figures</b></p><dl><dt>3.1. <a href="#id3734873">VISHNU Functional architecture diagram</a></dt><dt>3.2. <a href="#id3735014">VISHNU Database diagram</a></dt><dt>3.3. <a href="#id3735842">VISHNU Software architecture diagram</a></dt><dt>4.1. <a href="#id3735914">VISHNU Technical architecture diagram</a></dt><dt>4.2. <a href="#vishnu_overview_firewall">VISHNU Technical architecture with firewalls diagram</a></dt><dt>5.1. <a href="#id3736113">TMS job submission steps</a></dt><dt>5.2. <a href="#id3736233">TMS submit job sequence diagram</a></dt><dt>5.3. <a href="#id3736277">TMS deployment diagram</a></dt><dt>5.4. <a href="#id3736488">FMS synchronous transfer sequence diagram</a></dt><dt>5.5. <a href="#id3736518">FMS asynchronous transfer sequence diagram</a></dt><dt>5.6. <a href="#id3736571">FMS deployment diagram</a></dt></dl></div><div class="list-of-tables"><p><b>List of Tables</b></p><dl><dt>3.1. <a href="#id3735110">VISHNU Data Flows</a></dt></dl></div><div class="chapter" title="Chapter 1. Document presentation"><div class="titlepage"><div><div><h2 class="title"><a id="id3733268"></a>Chapter 1. Document presentation</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#id3733609">Document objectives</a></span></dt><dt><span class="section"><a href="#id3733627">Document structure</a></span></dt><dt><span class="section"><a href="#id3733682">References</a></span></dt><dt><span class="section"><a href="#id3733712">Acronyms and abbreviations</a></span></dt><dt><span class="section"><a href="#id3733893">Glossary</a></span></dt></dl></div><div class="section" title="Document objectives"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id3733609"></a>Document objectives</h2></div></div></div><p>This document provides a global view of the architecture for VISHNU and its environment. The target audience
        of this document is composed of software, system and network architects. The main objective of this document is to validate
        that the solution provided  matches the needs and constraints of the target environment. It can also
        be considered as a first version of a checklist for system deployment but some deployment details may still not be defined
        at the time this document is written and may be completed during the project development.
      </p></div><div class="section" title="Document structure"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id3733627"></a>Document structure</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Chapter 1 contains a description of the document itself and definitions of terms and acronyms.</p></li><li class="listitem"><p>Chapter 2 contains a global description of the VISHNU project: its objectives, its context including the main constraints
            and the main technical choices made for the technical solution proposed by SysFera.</p></li><li class="listitem"><p>Chapter 3 contains a description of the functional architecture of VISHNU: users, functional units, interfaces, data and security.</p></li><li class="listitem"><p>Chapter 4 contains a description of the technical architecture of VISHNU: clients and servers, network, databases.</p></li><li class="listitem"><p>Chapter 5 contains details of the architecture that are specific to some VISHNU modules.</p></li></ul></div></div><div class="section" title="References"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id3733682"></a>References</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>[D1.1a]: VISHNU General specifications</p></li><li class="listitem"><p>[D1.1b]: VISHNU "Spécifications techniques des besoins"</p></li><li class="listitem"><p>[D1.1c]: VISHNU API Detailed specifications</p></li></ul></div></div><div class="section" title="Acronyms and abbreviations"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id3733712"></a>Acronyms and abbreviations</h2></div></div></div><p>
        </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="bold"><strong>API</strong></span>: Application Programming Interface</p></li><li class="listitem"><p><span class="bold"><strong>CLI</strong></span>: Command Line Interface</p></li><li class="listitem"><p><span class="bold"><strong>DB</strong></span>: Database</p></li><li class="listitem"><p><span class="bold"><strong>FMS</strong></span>: File Management Service (VISHNU Module)</p></li><li class="listitem"><p><span class="bold"><strong>IMS</strong></span>: Information Management Service (VISHNU Module)</p></li><li class="listitem"><p><span class="bold"><strong>kB</strong></span>: Kilo-bytes</p></li><li class="listitem"><p><span class="bold"><strong>MB</strong></span>: Mega-bytes</p></li><li class="listitem"><p><span class="bold"><strong>n/a</strong></span>: Not Applicable</p></li><li class="listitem"><p><span class="bold"><strong>QoS</strong></span>: Quality of Service</p></li><li class="listitem"><p><span class="bold"><strong>TBC</strong></span>: To Be Completed</p></li><li class="listitem"><p><span class="bold"><strong>SSH</strong></span>: Secure Shell</p></li><li class="listitem"><p><span class="bold"><strong>TMS</strong></span>: Tasks Management Service (VISHNU Module)</p></li><li class="listitem"><p><span class="bold"><strong>UML</strong></span>: Unified Modeling Language (current version: v2.3)</p></li><li class="listitem"><p><span class="bold"><strong>UMS</strong></span>: Users Management Service (VISHNU Module)</p></li><li class="listitem"><p><span class="bold"><strong>WS</strong></span>: Web Services</p></li></ul></div><p>
      </p></div><div class="section" title="Glossary"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id3733893"></a>Glossary</h2></div></div></div><p>
        </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="bold"><strong>Computing resource</strong></span>: a server that is used to process batch jobs. This definition covers
            supercomputers, the cluster gateway servers and the cluster processing nodes.</p></li><li class="listitem"><p><span class="bold"><strong>Host</strong></span>: represents a physical client or server computer system.</p></li><li class="listitem"><p><span class="bold"><strong>Middleware</strong></span>: an application that sits "in the middle" between application software that
            may be working on different operating systems. It is similar to the middle layer of a three-tier single system architecture,
            except that it is stretched across multiple systems or applications. [source: Wikipedia]</p></li><li class="listitem"><p><span class="bold"><strong>Network firewall</strong></span>: a system that filters the network traffic between two or more different network areas based
              on traffic protocol patterns.</p></li><li class="listitem"><p><span class="bold"><strong>POSIX</strong></span>: international standard that defines an API to access a filesystem.</p></li><li class="listitem"><p><span class="bold"><strong>Storage resource</strong></span>: a server that is used to store data as files. This definition covers the
            user desktops or laptops and all unix servers.</p></li><li class="listitem"><p><span class="bold"><strong>SysFera-DS</strong></span>: open-source middleware developped by SysFera.</p></li><li class="listitem"><p><span class="bold"><strong>SysFera-DS Agent</strong></span>: SysFera-DS process running permanently (or daemon).</p></li><li class="listitem"><p><span class="bold"><strong>VISHNU system</strong></span>: set of all elements (software, hardware, data) that compose a single instance of the
            VISHNU application and that work together to provide VISHNU services to the users.</p></li></ul></div><p>
      </p></div></div><div class="chapter" title="Chapter 2. Global description of VISHNU"><div class="titlepage"><div><div><h2 class="title"><a id="id3734040"></a>Chapter 2. Global description of VISHNU</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#id3734053">Project sheet</a></span></dt><dt><span class="section"><a href="#id3734473">QoS objectives</a></span></dt></dl></div><p>This chapter contains a synthetic presentation of the ins and outs of the system architecture.</p><div class="section" title="Project sheet"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id3734053"></a>Project sheet</h2></div></div></div><div class="informaltable"><table border="1"><colgroup><col width="5cm" /><col /></colgroup><tbody><tr><td><p>Project Title</p></td><td><p>VISHNU</p></td></tr><tr><td><p>Version</p></td><td><p>1.0</p></td></tr><tr><td><p>Objective</p></td><td><p>To provide a standardized, integrated, secure, reliable and high performance interface to heterogeneous scientific computing resources
                  used by research and development teams.</p></td></tr><tr><td><p>Beneficiaries</p></td><td><p>EDF R&amp;D</p></td></tr><tr><td><p>Impact</p></td><td><p>This project is critical for the beneficiary organization. The realized system will be transfered to different
                  enterprise organizations for deployment on their own infrastructure.</p></td></tr><tr><td><p>Project Duration</p></td><td><p>7 months</p></td></tr><tr><td><p>Major constraints</p></td><td>
                  <p>- VISHNU architecture must not be tied to a given deployment environment but must be usable on different system and network environments
                    as long as they are compliant with the requirements defined in [D1.1b].</p>
                  <p>- The installation and usage of VISHNU must not require root access on the computing or storage resources.</p>
                  <p>- The source code must be under the CeCILL A v2 license and VISHNU must be distributed as a debian package and a source package.</p>
                </td></tr><tr><td><p>Security constraints</p></td><td>
                  <p>- VISHNU requires user authentication.</p>
                </td><td>
                  <p>- VISHNU does not use data encryption except for file transfers.</p>
                </td><td>
                  <p>- VISHNU provides two levels of access privilege: standard users and administrators.</p>
                </td><td>
                  <p>- VISHNU does not handle commercially sensitive information.</p>
                </td><td>
                  <p>- VISHNU must not compromize access to user unix accounts on the infrastructure.</p>
                </td></tr><tr><td><p>Traceability constraints</p></td><td>
                  <p>VISHNU will keep track of all user actions with their date and time, user identifier, client host identifier and action details.</p>
                  <p>VISHNU will provide a log of all user actions that allows the user herself or an administrator to redo past actions.</p>
                </td><td class="auto-generated"> </td><td class="auto-generated"> </td><td class="auto-generated"> </td><td class="auto-generated"> </td></tr><tr><td><p>System services</p></td><td>
                  <p>VISHNU will provide the following services:</p>
                   <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>User management services (UMS): authentication and session management.</p></li><li class="listitem"><p>Information management services (IMS): monitoring and control services.</p></li><li class="listitem"><p>Tasks management services (TMS): submission of tasks (jobs) on computing resources.</p></li><li class="listitem"><p>File management services (FMS): display and transfer of files between storage resources.</p></li></ul></div>
                </td><td class="auto-generated"> </td><td class="auto-generated"> </td><td class="auto-generated"> </td><td class="auto-generated"> </td></tr><tr><td><p>System interfaces</p></td><td>
                  <p>VISHNU will provide the following interfaces:</p>
                   <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>a Web Services interface</p></li><li class="listitem"><p>a Python shell interface</p></li><li class="listitem"><p>a C++ application programming interface (API)</p></li><li class="listitem"><p>a Unix command line interface</p></li></ul></div>
                </td><td class="auto-generated"> </td><td class="auto-generated"> </td><td class="auto-generated"> </td><td class="auto-generated"> </td></tr><tr><td><p>System users</p></td><td><p>VISHNU will be used by managers, engineers and researchers. A user may either use a man-machine interface (web or unix shell)
                  or a programming interface (Python or C++) to access the system.</p></td><td class="auto-generated"> </td><td class="auto-generated"> </td><td class="auto-generated"> </td><td class="auto-generated"> </td></tr><tr><td><p>Database system</p></td><td><p>VISHNU will use either a PostgreSQL 8.x or MySQL v5.x database server.</p></td><td class="auto-generated"> </td><td class="auto-generated"> </td><td class="auto-generated"> </td><td class="auto-generated"> </td></tr><tr><td><p>Architecture choices</p></td><td>
                  <p>- VISHNU will be based on a distributed service-oriented middleware for the communication between all clients and servers.</p>
                  <p>- VISHNU will be modular so that new services can be easily integrated with the existing ones and so that each module can have its own version.</p>
                  <p>- VISHNU will use the SSH protocol for file transfers and for tunneling of application flows across network firewalls.</p>
                  <p>- VISHNU will use the mechanisms of the underlying Unix security system to protect access to sensitive information (e.g. SSH keys).</p>
                  <p>- VISHNU will store all internal and user data (except user files) in a central database.</p>
                </td><td class="auto-generated"> </td><td class="auto-generated"> </td><td class="auto-generated"> </td><td class="auto-generated"> </td></tr></tbody></table></div></div><div class="section" title="QoS objectives"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id3734473"></a>QoS objectives</h2></div></div></div><div class="informaltable"><table border="1"><colgroup><col width="5cm" /><col /></colgroup><tbody><tr><td>Availability</td><td>
                <p>- The individual failure of a computing or storage resource must not impact the global availability of VISHNU but only services located on that resource.</p>
                <p>- The components of the VISHNU system with the exception of the Web Server and the Database will be monitored internally and restarted automatically within less than 1 minute (the real delay will depend 
                        on the monitoring frequency which will be set by the administrator)</p>
                <p>- VISHNU will keep internal data stored in a central database and use this data to recover its state before a crash or manual termination.</p>
                <p>- In case of database crash, VISHNU will be restarted using a standby database that contains a copy of the main database.</p>
              </td></tr><tr><td>Performance</td><td>
                <p>- VISHNU will support at least 100 simultaneous users and peaks of 100 simultaneous requests.</p>
                <p>- The latency for all user requests sent through the VISHNU C++ API or CLI will be less than a similar request done using SSH.</p>
              </td></tr></tbody></table></div></div></div><div class="chapter" title="Chapter 3. Functional architecture"><div class="titlepage"><div><div><h2 class="title"><a id="id3734567"></a>Chapter 3. Functional architecture</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#id3734575">VISHNU concepts</a></span></dt><dt><span class="section"><a href="#id3734846">Functional architecture diagram</a></span></dt><dt><span class="section"><a href="#id3734900">Database description</a></span></dt><dd><dl><dt><span class="section"><a href="#id3734906">Functional view</a></span></dt><dt><span class="section"><a href="#id3735003">Logical view</a></span></dt></dl></dd><dt><span class="section"><a href="#id3735041">Data flows</a></span></dt><dt><span class="section"><a href="#id3735713">Software architecture diagram</a></span></dt></dl></div><div class="section" title="VISHNU concepts"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id3734575"></a>VISHNU concepts</h2></div></div></div><p>This paragraph introduces important concepts that are used in the definition of the functional and technical architecture</p><p>
        </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="bold"><strong>Computing server</strong></span>: a server that provides computing services to the user through a batch scheduler software
            like LoadLeveler, Torque or SLURM. In the case of a cluster, the computing server is also known as the gateway server.</p></li><li class="listitem"><p><span class="bold"><strong>Database Server (DBS)</strong></span>: represents a database server used by VISHNU.</p></li><li class="listitem"><p><span class="bold"><strong>Storage server</strong></span>: a server that provides filesystem access to the user through a standard POSIX API.</p></li><li class="listitem"><p><span class="bold"><strong>VISHNU Deployment Map</strong></span>: this map defines which physical host is providing which VISHNU services or on which
            are running VISHNU internal processes. This map will be described physically as a XML file and will be used by the VISHNU Admin System (see below
            inside the VBS category) to launch, check and stop the VISHNU system.</p></li><li class="listitem"><p><span class="bold"><strong>VISHNU Services Servers (VSS)</strong></span>: this is a generic component of the functional architecture that
                  represents all the VISHNU server components providing services to the user. The different classes of this generic component are 
                  the following in the context of the VISHNU 1.0 project, but the list of classes could be extended in the future:</p><p>
              </p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p>FMS Server (File Management Server): this role can be assigned only to a Storage Server</p></li><li class="listitem"><p>IMS Server (Infrastructure Management Server): this role can be assigned to any VSS</p></li><li class="listitem"><p>TMS Server (Tasks Management Server): this role can be assigned only to a Computing Server</p></li><li class="listitem"><p>UMS Server (Users Management Server): this role can be assigned to any VSS</p></li></ul></div><p>
             </p></li><li class="listitem"><p><span class="bold"><strong>VISHNU Backbone servers (VBS)</strong></span>: this is a generic component of the functional architecture that 
             represents all VISHNU server components that are used by VISHNU to handle user requests (i.e. receive the request and forward it
             to the appropriate VSS) and to administrate VISHNU.
             A physical server may host both a VISHNU Backbone server and a VISHNU Services Server as these are two independent functionalities.
             The different classes of this generic component are the following:</p><p>
              </p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p><span class="bold"><strong>SysFera-DS Forwarder</strong></span>: represents a SysFera-DS agent that provides connectivity between
                   different networks through a dedicated SSH tunnel.</p></li><li class="listitem"><p><span class="bold"><strong>SysFera-DS MasterAgent (MA)</strong></span>: represents a SysFera-DS agent that
                  processes requests coming directly from client systems.</p></li><li class="listitem"><p><span class="bold"><strong>VISHNU Admin system (VAS)</strong></span>: represents a component used by an administrator to launch 
                  and stop the VISHNU system and to restart individually VISHNU processes.</p></li></ul></div><p>
            </p></li><li class="listitem"><p><span class="bold"><strong>VISHNU Database</strong></span>: represents the logical database used by VISHNU to store internal data.</p></li><li class="listitem"><p><span class="bold"><strong>VISHNU Machine</strong></span>: represents a given host that has been registered in the VISHNU Database by
             a VISHNU administrator. Each machine is identified by a unique identifier that is generated when the machine is registered in
             VISHNU.</p></li><li class="listitem"><p><span class="bold"><strong>VISHNU Module</strong></span>: macro software component that provides a set of services to the user. It contains both client and 
            server software providing these services. A module may have dependencies to other modules.</p></li><li class="listitem"><p><span class="bold"><strong>VISHNU User</strong></span>: represents the unix user that is used to run all VISHNU internal processes (VBS or VSS) on the different host(s)
             used by the VISHNU System.</p></li></ul></div><p>
      </p></div><div class="section" title="Functional architecture diagram"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id3734846"></a>Functional architecture diagram</h2></div></div></div><p>The Figure 3.1 shows the different functional parts of VISHNU and their interactions. On the client side (upper
        part of the diagram) are shown the different interface components that are provided to the users: APIs and command-line interface.
        These interfaces provide access to the different VISHNU modules (UMS, TMS, FMS, IMS) using a client component, that is itself
        connected with the corresponding server component through the SysFera-DS Middleware. The server components handle data items that
        belong to different inter-related databases, each managing a specific kind of data (a more detailed description of the databases is
        provided in section 3.2). The TMS and FMS Server components also handle some specific interaction with external entities: the
        batch schedulers (LoadLeveler, Torque or SLURM) for the management of jobs on clusters or supercomputers, and the SCP and RSYNC programs
        of the underlying Linux system for the transfer of files between two storage servers or between a client system and a storage server.
       </p><div class="figure"><a id="id3734873"></a><p class="title"><b>Figure 3.1. VISHNU Functional architecture diagram</b></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/png/functional_architecture.png" align="middle" alt="VISHNU Functional architecture diagram" /></div></div></div><br class="figure-break" /></div><div class="section" title="Database description"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id3734900"></a>Database description</h2></div></div></div><div class="section" title="Functional view"><div class="titlepage"><div><div><h3 class="title"><a id="id3734906"></a>Functional view</h3></div></div></div><p>The following database components are used by the VISHNU system to store persistent data and provide historical data to the users:
          </p><p>
        </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="bold"><strong>Users and infrastructure database</strong></span>: contains all data related to users, user configuration
            and the VISHNU managed infrastructure information.</p></li><li class="listitem"><p><span class="bold"><strong>Sessions database</strong></span>: contains all data related to user sessions and the history of commands
            sent during the sessions.</p></li><li class="listitem"><p><span class="bold"><strong>Jobs database</strong></span>: contains meta-information about the jobs submitted on the computing servers.</p></li><li class="listitem"><p><span class="bold"><strong>File transfers database</strong></span>: contains meta-information about the file transfers initiated by users of
            VISHNU between systems that belong to the VISHNU Managed Infrastructure.</p></li><li class="listitem"><p><span class="bold"><strong>Monitoring database</strong></span>: contains historical data about the status of systems that belong to the VISHNU
            Managed Infrastructure. The status includes system hardware information (cpu usage, disk usage, memory usage, etc.).</p></li></ul></div><p>
        </p></div><div class="section" title="Logical view"><div class="titlepage"><div><div><h3 class="title"><a id="id3735003"></a>Logical view</h3></div></div></div><p>The Figure 3.2 describes all the tables of the VISHNU database with their relationships.</p><div class="figure"><a id="id3735014"></a><p class="title"><b>Figure 3.2. VISHNU Database diagram</b></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/png/database.png" align="middle" alt="VISHNU Database diagram" /></div></div></div><br class="figure-break" /></div></div><div class="section" title="Data flows"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id3735041"></a>Data flows</h2></div></div></div><p>The Table 3.1 lists all the VISHNU data flows between the different functional elements of the architecture. Please note that
        the data flows involving the <span class="quote">“<span class="quote">Forwarder</span>”</span> component are used only in the case of a deployment that requires crossing
        firewalls between different network areas (see chapter 4).</p><p>The bandwidth information provided in the table is an average estimated size for one standard user request sent by the client
        to the VISHNU system. The bandwidth requirement can be obtained by multiplying this value by the request rate. A <span class="quote">“<span class="quote">standard user request</span>”</span>
        is a request that returns data to the user about VISHNU managed objects (users, sessions, commands, jobs, file transfers, accounts)
        considering that the size of this data set is not more than 10KBytes.</p><p>The <span class="bold"><strong>NVSS</strong></span> number represents the number of VISHNU Services Servers in the VISHNU System. Please note that this is
        the number of logical servers not the number of physical servers.</p><p>The <span class="bold"><strong>aggregation</strong></span> term is used when the bandwidth of the flow is the aggregation of the bandwidth
        of all flows that are tunneled through that flow.</p><p>The <span class="bold"><strong>CORBA</strong></span> protocol ports: CORBA uses the IIOP (Internet Inter-ORB Protocol) on port 2809/tcp by default for omniNames
       and random user tcp ports.</p><div class="table"><a id="id3735110"></a><p class="title"><b>Table 3.1. VISHNU Data Flows</b></p><div class="table-contents"><table summary="VISHNU Data Flows" border="1"><colgroup><col width="1cm" /><col width="3cm" /><col width="3cm" /><col width="2cm" /><col width="2cm" /><col width="3cm" /></colgroup><thead><tr><th>ID</th><th>Source</th><th>Destination</th><th>Protocol</th><th>Bandwidth</th><th>Description</th></tr></thead><tbody><tr><td>CMA</td><td>Client system</td><td>VISHNU MA</td><td>CORBA</td><td>1kB/request</td><td>SysFera-DS Request</td></tr><tr><td>COS</td><td>Client system</td><td>omniNames server</td><td>CORBA</td><td>1kB/request</td><td>SysFera-DS Request</td></tr><tr><td>WMA</td><td>Web server</td><td>VISHNU MA</td><td>CORBA</td><td>1kB/request</td><td>SysFera-DS Request</td></tr><tr><td>CWS</td><td>Client system</td><td>Web server</td><td>HTTP (80/tcp)</td><td>2kB/request</td><td>Web service request</td></tr><tr><td>OSS</td><td>omniNames server</td><td>VISHNU VSS</td><td>CORBA</td><td>1kB*NVSS /request</td><td>Corba request</td></tr><tr><td>CVS</td><td>Client system</td><td>VISHNU VSS</td><td>CORBA</td><td>15kB/request</td><td>SysFera-DS Solve</td></tr><tr><td>WVS</td><td>Web server</td><td>VISHNU VSS</td><td>CORBA</td><td>15kB/request</td><td>SysFera-DS Solve</td></tr><tr><td>MAS</td><td>VISHNU MA</td><td>VISHNU VSS</td><td>CORBA</td><td>1kB*NVSS /request</td><td>SysFera-DS Submit</td></tr><tr><td>VSD</td><td>VISHNU VSS</td><td>Database server</td><td>MySQL (3306/tcp) or PostgreSQL (5432/tcp)</td><td>11kB/request</td><td>Database connection</td></tr><tr><td>VDT</td><td>VISHNU VSS</td><td>VISHNU VSS</td><td>CORBA</td><td>TBC (&lt;1kB /request)</td><td>Data transfer between servers</td></tr><tr><td>VFT</td><td>VISHNU Machine</td><td>VISHNU Machine</td><td>SSH (22/tcp)</td><td>depends on file size</td><td>File transfer between machines</td></tr><tr><td>UFT</td><td>Client system or Web server</td><td>VISHNU Machine</td><td>SSH (22/tcp)</td><td>depends on file size</td><td>Upload file</td></tr><tr><td>DFT</td><td>VISHNU Machine</td><td>Client system or Web server</td><td>SSH (22/tcp)</td><td>depends on file size</td><td>Download file</td></tr><tr><td>CFT</td><td>VISHNU VSS</td><td>VISHNU Machine or Client system or Web server</td><td>SSH (22/tcp)</td><td>1kB/request</td><td>Remote file command</td></tr><tr><td>VSE</td><td>VISHNU VSS</td><td>SMTP server</td><td>SMTP (25/tcp)</td><td>&lt;10kB per message</td><td>Email to users or administrators</td></tr><tr><td>ADM</td><td>Admin system (VAS)</td><td>VISHNU VSS and VBS</td><td>SSH (22/tcp)</td><td>&lt;1kB/s</td><td>Control of VISHNU processes</td></tr><tr><td>FWD</td><td>Forwarder</td><td>Forwarder</td><td>SSH (22/tcp)</td><td>aggregation</td><td>CORBA Tunnel</td></tr><tr><td>CWD</td><td>Client system or Web server</td><td>Forwarder</td><td>CORBA</td><td>aggregation</td><td>CORBA call through forwarder</td></tr><tr><td>SWD</td><td>VISHNU VSS or VBS</td><td>Forwarder</td><td>CORBA</td><td>aggregation</td><td>CORBA call through forwarder</td></tr></tbody></table></div></div><br class="table-break" /></div><div class="section" title="Software architecture diagram"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id3735713"></a>Software architecture diagram</h2></div></div></div><p>The Figure 3.3 describes the different software components of VISHNU with their dependencies.</p><p>This diagram is a UML component diagram:</p><p>
        </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p> A component can be included inside another parent component (e.g. a package).</p></li><li class="listitem"><p> A component can contain internal classifiers that implement the interface provided by the component (internal
            classifiers are shown by a box without the component icon).</p></li><li class="listitem"><p> A dotted line arrow represent a dependency between two components.</p></li><li class="listitem"><p> A circle represents a provided interface and is connected to the component that provides it.</p></li><li class="listitem"><p> A semi-circle represents a required interface and is connected to the component that requires it.</p></li></ul></div><p>
      </p><p>The following terms and abbreviations are used in the Figure 3.3:</p><p>
        </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="bold"><strong>CPP</strong></span>: C++</p></li><li class="listitem"><p><span class="bold"><strong>Py</strong></span>: Python</p></li><li class="listitem"><p><span class="bold"><strong>Proxy</strong></span>: Generic component type described in the <span class="quote">“<span class="quote">proxy pattern</span>”</span> which is used when a class acts
                     as an interface to another class.</p></li><li class="listitem"><p><span class="bold"><strong>SeD</strong></span>: Server Daemon</p></li><li class="listitem"><p><span class="bold"><strong>WS</strong></span>: Web Services package</p></li></ul></div><p>
      </p><div class="figure"><a id="id3735842"></a><p class="title"><b>Figure 3.3. VISHNU Software architecture diagram</b></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/png/VISHNU Components Overview.png" align="middle" alt="VISHNU Software architecture diagram" /></div></div></div><br class="figure-break" /></div></div><div class="chapter" title="Chapter 4. Technical architecture"><div class="titlepage"><div><div><h2 class="title"><a id="id3735870"></a>Chapter 4. Technical architecture</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#id3735885">Technical architecture diagram</a></span></dt><dt><span class="section"><a href="#id3735943">Technical architecture with network firewalls</a></span></dt></dl></div><p>This chapter describes the deployment aspects of a VISHNU System. The first section presents a typical deployment
      of VISHNU on a single network. The second section presents a more complex deployment of VISHNU where the systems involved
      are located on different networks isolated by firewalls.</p><div class="section" title="Technical architecture diagram"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id3735885"></a>Technical architecture diagram</h2></div></div></div><p>The Figure 4.1 shows a VISHNU system deployed on a set of hosts where each class of VSS and VBS is running
         on one dedicated host and where all clients and servers can connect to each other without crossing network firewalls.
         The SysFera-DS middleware uses the CORBA Bus for communication between the client systems and the MasterAgent (MA) server
         or a VSS, and between the MA server and a VSS.
         All VSS connect directly to the Database Server and can communicate together through CORBA or
	 transfer files through SSH (not shown on the diagram).
       </p><p>During the startup or termination phases of VISHNU, the VISHNU Admin System (VAS) uses SSH connections to all the
         VBS and VSS hosts to launch the VISHNU internal processes. These connections are not shown on the diagram for better readability.
         These connections are all using the VISHNU User SSH keys.
       </p><div class="figure"><a id="id3735914"></a><p class="title"><b>Figure 4.1. VISHNU Technical architecture diagram</b></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/png/VISHNU Deployment Overview Diagram.png" align="middle" alt="VISHNU Technical architecture diagram" /></div></div></div><br class="figure-break" /></div><div class="section" title="Technical architecture with network firewalls"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id3735943"></a>Technical architecture with network firewalls</h2></div></div></div><p>The Figure 4.2 shows a VISHNU system deployed on a set of hosts located on different networks:
       </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="bold"><strong>Network A</strong></span>: contains a client system (user laptop) and a SysFera-DS Forwarder host.</p></li><li class="listitem"><p><span class="bold"><strong>Network B</strong></span>: contains VISHNU VBSs (with one hosting a SysFera-DS Forwarder). This network could also contain some VSS servers.</p></li><li class="listitem"><p><span class="bold"><strong>Network C</strong></span>: contains the Web server, the Database Server and a SysFera-DS Forwarder host.</p></li><li class="listitem"><p><span class="bold"><strong>Network D</strong></span>: contains a VSS (that could be a UMS, TMS, IMS or FMS Server) and a SysFera-DS Forwarder on the same host.</p></li></ul></div><p>In this architecture, all inter-network communications are using the SSH protocol or the HTTP protocol (for client to web server).</p><p>The role of the SysFera-DS Forwarder is to allow CORBA communications (described in §4.1) across network firewalls. A SysFera-DS Forwarder
         agent must be running on both sides of the firewall and be accessible by other hosts on the same network. Within one network, all
	 communications are as described in §4.1.</p><p>The startup and termination phases are identical to the architecture of §4.1., the SysFera-DS Forwarders being started and managed
         by the VISHNU Admin Server.</p><div class="figure"><a id="vishnu_overview_firewall"></a><p class="title"><b>Figure 4.2. VISHNU Technical architecture with firewalls diagram</b></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/png/VISHNU Deployment Overview Diagram with firewall.png" align="middle" alt="VISHNU Technical architecture with firewalls diagram" /></div></div></div><br class="figure-break" /></div></div><div class="chapter" title="Chapter 5. VISHNU modules architecture"><div class="titlepage"><div><div><h2 class="title"><a id="id3736059"></a>Chapter 5. VISHNU modules architecture</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#id3736072">TMS module details</a></span></dt><dd><dl><dt><span class="section"><a href="#id3736085">TMS submit job call sequence </a></span></dt><dt><span class="section"><a href="#id3736260">TMS server deployment</a></span></dt></dl></dd><dt><span class="section"><a href="#id3736305">FMS module details</a></span></dt><dd><dl><dt><span class="section"><a href="#id3736319">FMS service call sequence</a></span></dt><dt><span class="section"><a href="#id3736550">FMS server deployment</a></span></dt></dl></dd></dl></div><p>This chapter contains details of the VISHNU architecture for some VISHNU modules.</p><div class="section" title="TMS module details"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id3736072"></a>TMS module details</h2></div></div></div><p>This section presents the specificities of TMS (Tasks Management Service) services architecture and the
        model of deployment for this module.</p><div class="section" title="TMS submit job call sequence"><div class="titlepage"><div><div><h3 class="title"><a id="id3736085"></a>TMS submit job call sequence </h3></div></div></div><p> Among the services provided by the TMS module we present the call sequence for the <span class="bold"><strong>submit job function.</strong></span>
          For the specifications of this service, see the use case T1.CP1. </p><p> The following steps and diagrams represent the different steps of a job submission through vishnu </p><p>  
          </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p> A TMS server must be running on each VISHNU Machine where a batch scheduler is installed.</p></li><li class="listitem"><p> The user must open the VISHNU session before using the VISHNU submit job function.  </p></li><li class="listitem"><p> After authentification of the user, a valid VISHNU session key is created, the submit function uses 
              this session key to submit a job through the VISHNU system.   </p></li><li class="listitem"><p> In addition of the session key value, the VISHNU submit function takes as arguments the identifier of 
              the machine on which the job must be submitted, the path of the script containing the job characteristics and the possible options.</p></li><li class="listitem"><p>The machineId must be known to the VISHNU system (i.e. it has been registered by a VISHNU Administrator).</p></li><li class="listitem"><p>The user who wants to submit a job must have a <span class="bold"><strong>VISHNU local account</strong></span>
              configured on the machine. A local account on a machine contains the unix account details
              of the VISHNU user on the corresponding host (user login, home directory path, ssh key path).</p></li><li class="listitem"><p> To submit a job the VISHNU submit function program contacts the Sysfera-DS agent to get the reference of the machine on which the job will be submitted.
                       </p></li><li class="listitem"><p> The submit function program contacts the selected machine and sends all input data (sessionKey, machineId, scriptPath and options) and waits for the output values : a valid output valid or a VISHNU exception. The machineId is valid if it exists in the vishnu Data Base and if the submit job owner has an account on this machine. </p></li><li class="listitem"><p> The TMS server launched on the selected machine receives the input values, checks the validity of the sessionKey and machineId by contacting the VISHNU Database.  </p></li><li class="listitem"><p> If the two values are valid, the TMS server calls the underlying batch scheduler API submit function (llsubmit(...)  for the LoadLeveler scheduler, pbs_submit(...) for Torque scheduler, slurm_submit_batch_job(...) for SLURM scheduler).</p></li><li class="listitem"><p> If the job was performed successfully, the TMS creates a vishnu jobId and sends it back to the user.</p></li></ul></div><p>
       </p><div class="figure"><a id="id3736113"></a><p class="title"><b>Figure 5.1. TMS job submission steps</b></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/png/jobSubmitSequenceDiagram.png" align="middle" alt="TMS job submission steps" /></div></div></div><br class="figure-break" /><div class="figure"><a id="id3736233"></a><p class="title"><b>Figure 5.2. TMS submit job sequence diagram</b></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/png/jobSubmitAsthaSequenceDiagram.png" align="middle" alt="TMS submit job sequence diagram" /></div></div></div><br class="figure-break" /></div><div class="section" title="TMS server deployment"><div class="titlepage"><div><div><h3 class="title"><a id="id3736260"></a>TMS server deployment</h3></div></div></div><p>The following diagram shows the relationships and their cardinalities between the different hosts involved in the deployment
          of the VISHNU TMS module. Several TMS Servers can be deployed within a single VISHNU infrastructure and each will provide the same set
            of services for a given batch scheduler. The TMS Servers will share the same VISHNU database where all logs and
            dynamical information will be stored.</p><div class="figure"><a id="id3736277"></a><p class="title"><b>Figure 5.3. TMS deployment diagram</b></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/png/TMSDeploymentDiagram.png" align="middle" alt="TMS deployment diagram" /></div></div></div><br class="figure-break" /></div></div><div class="section" title="FMS module details"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id3736305"></a>FMS module details</h2></div></div></div><p>This section presents the specificities of FMS (File Management Service) services architecture and the
        model of deployment for this module.</p><div class="section" title="FMS service call sequence"><div class="titlepage"><div><div><h3 class="title"><a id="id3736319"></a>FMS service call sequence</h3></div></div></div><p>Among the services provided by the FMS module we present the call sequence for three of the most representative
          ones: a <span class="bold"><strong>file copy</strong></span> from "MachineA" to "MachineB" with the synchronous
          and asynchronous variants, and the service for file information retrieval. 
          For the specifications of these services, see the use cases F2.CP1, F2.CP2 and F1.DI5 in [D1.1a].</p><p>In the following diagrams, the objects represents different processes that may be running on different hosts. The generic
          names "MachineA" and "MachineB" could be mapped to either a VISHNU Machine or to the Client host itself. The
            constraints on a given host to be "MachineA" or "MachineB" are the following:</p><p>
          </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>A ssh server must be running on the host.</p></li><li class="listitem"><p>The programs <span class="command"><strong>scp</strong></span>, <span class="command"><strong>rsync</strong></span>, <span class="command"><strong>ls</strong></span>, <span class="command"><strong>rm</strong></span>,
            <span class="command"><strong>head</strong></span>, <span class="command"><strong>tail</strong></span>, <span class="command"><strong>mkdir</strong></span>, <span class="command"><strong>chgrp</strong></span>, <span class="command"><strong>cat</strong></span>
            must be available on the host.</p></li><li class="listitem"><p>The host must be known to the VISHNU system as either a <span class="bold"><strong>Machine</strong></span> 
            (i.e. it has been registered by a VISHNU Administrator)
              or a <span class="bold"><strong>Client</strong></span> (i.e it is the host from where the request is sent).</p></li><li class="listitem"><p>The VISHNU user who is requesting the file transfer must have a <span class="bold"><strong>VISHNU local account</strong></span>
              configured on both machines except if the machine is the client host itself. A local account on a machine contains the unix account details
              of the VISHNU user on the corresponding host (user login, home directory path, ssh key path).</p></li><li class="listitem"><p>The ssh configuration on both hosts corresponding to "MachineA" and "MachineB"
              <span class="italics">and the network</span> between these hosts must allow ssh connections: </p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p>from the FMS Server host to "MachineA" and to "MachineB".</p></li><li class="listitem"><p>from "MachineA" to "MachineB".</p></li></ul></div><p>
              </p></li></ul></div><p>
        </p><p>The call sequence is designed around the usage of the <span class="bold"><strong>scp</strong></span> and <span class="bold"><strong>rsync</strong></span>
        command-line programs according to the project requirements. Therefore the FMS Server software will use system ""exec"" calls to
        launch file transfers or other system calls related to file management (chmod, ls, etc.). This solution allows access to many hosts from a
        single FMS server (see deployment paragraph below), but reduces the interoperability as it depends on unix/linux-specific features.
        </p><div class="figure"><a id="id3736488"></a><p class="title"><b>Figure 5.4. FMS synchronous transfer sequence diagram</b></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/png/FMS SynchronousTransferSequenceDiagram.png" align="middle" alt="FMS synchronous transfer sequence diagram" /></div></div></div><br class="figure-break" /><p>In the case of an asynchronous file transfer, the call from client1 to mServer1 terminates as soon as the file transfer
          is initiated from MachineA. The state of an asynchronous file transfer can be requested using another FMS Service, and the
          transfer can be stopped asynchronously as shown on the diagram.</p><div class="figure"><a id="id3736518"></a><p class="title"><b>Figure 5.5. FMS asynchronous transfer sequence diagram</b></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/png/FMS AsynchronousTransferSequenceDiagram.png" align="middle" alt="FMS asynchronous transfer sequence diagram" /></div></div></div><br class="figure-break" /></div><div class="section" title="FMS server deployment"><div class="titlepage"><div><div><h3 class="title"><a id="id3736550"></a>FMS server deployment</h3></div></div></div><p>The following diagram shows the relationships and their cardinalities between the different hosts involved in the deployment
          of the VISHNU FMS module. Several FMS Servers can be deployed within a single VISHNU infrastructure and will provide the same
            services for all the machines configured in VISHNU. The FMS Servers will share the same VISHNU database where all logs and
            dynamical information will be stored.</p><p>Note: the choice of a particular FMS Server will be done automatically by VISHNU and will be transparent for the user.</p><div class="figure"><a id="id3736571"></a><p class="title"><b>Figure 5.6. FMS deployment diagram</b></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/png/FMS_Deployment_Diagram.png" align="middle" alt="FMS deployment diagram" /></div></div></div><br class="figure-break" /></div></div></div></div></body></html>
