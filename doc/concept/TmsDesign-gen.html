<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>D4.1a - VISHNU Tasks Management Service Package Design</title><meta name="generator" content="DocBook XSL Stylesheets V1.75.2" /></head><body><div class="book" title="D4.1a - VISHNU Tasks Management Service Package Design"><div class="titlepage"><div><div><h1 class="title"><a id="idm14568264"></a>D4.1a - VISHNU Tasks Management Service Package Design</h1></div><div><div class="author"><h3 class="author"><span class="firstname">Benjamin</span> <span class="surname">Isnard</span></h3></div></div><div><div class="author"><h3 class="author"><span class="firstname">Daouda</span> <span class="surname">Traoré</span></h3></div></div><div><div class="author"><h3 class="author"><span class="firstname">Eugène</span> <span class="surname">Pamba Capo-Chichi</span></h3></div></div><div><div class="author"><h3 class="author"><span class="firstname">Kevin</span> <span class="surname">Coulomb</span></h3></div></div><div><div class="author"><h3 class="author"><span class="firstname">Ibrahima</span> <span class="surname">Cissé</span></h3></div></div><div><div class="revhistory"><table border="1" width="100%" summary="Revision history"><tr><th align="left" valign="top" colspan="3"><b>Revision History</b></th></tr><tr><td align="left">Revision 1</td><td align="left">25/03/2011</td><td align="left">SysFera</td></tr><tr><td align="left" colspan="3">
          
        <p>Deliverable version</p></td></tr><tr><td align="left">Revision 2</td><td align="left">20/05/2011</td><td align="left">SysFera</td></tr><tr><td align="left" colspan="3">
          
        <p>Modified description of section dedicated to Job Owner and Identifier (section 2.3). Added TMS submitJob sequence diagram (three figures added). Modified TMS Client Class Diagram, TMS Server Class Diagram. Modified TMS Client Side Components, TMS Server Side Components. Added TMS Monitor Daemon description in the definitions of components in section 2.1. Added TMS Monitor Daemon component in TMS Server Side Components. Modified exceptions list of all services in internal API specification chapter. Modified jobSubmit, jobOutputGetResult, jobOutputGetCompletedJobs services in internal API specification chapter.</p></td></tr><tr><td align="left">Revision 3</td><td align="left">21/07/2011</td><td align="left">SysFera</td></tr><tr><td align="left" colspan="3">
           
        <p>Added SLURM batch scheduler </p></td></tr><tr><td align="left">Revision 4</td><td align="left">10/01/2012</td><td align="left">SysFera</td></tr><tr><td align="left" colspan="3">
          
          
          
          
          
        <p>Updates of TMS:</p><p>Added new internal service named jobSubmit_autom.</p><p>Added new internal service named getListOfJobs_all.</p><p>Modified TMS Data Class diagram.</p><p>Modified TMS Server Class diagram.</p></td></tr><tr><td align="left">Revision 5</td><td align="left">24/02/2012</td><td align="left">SysFera</td></tr><tr><td align="left" colspan="3">
          
        <p>Added LSF batch scheduler </p></td></tr><tr><td align="left">Revision 6</td><td align="left">12/04/2012</td><td align="left">SysFera</td></tr><tr><td align="left" colspan="3">
          
        <p>Added Grid Engine batch scheduler </p></td></tr><tr><td align="left">Revision 7</td><td align="left">12/01/2013</td><td align="left">SysFera</td></tr><tr><td align="left" colspan="3">
          
        <p>Added posix SHELL, update for design and new paragraph, plus some data about plugins </p></td></tr></table></div></div></div><hr /></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="chapter"><a href="#idp13464">1. Document presentation</a></span></dt><dd><dl><dt><span class="section"><a href="#idp13816">Document objectives</a></span></dt><dt><span class="section"><a href="#idp15536">Document structure</a></span></dt><dt><span class="section"><a href="#idm33544">References</a></span></dt><dt><span class="section"><a href="#idp33984">Acronyms</a></span></dt><dt><span class="section"><a href="#idp40888">Glossary</a></span></dt></dl></dd><dt><span class="chapter"><a href="#idp43392">2. System Architecture</a></span></dt><dd><dl><dt><span class="section"><a href="#idp43712">Overview of the TMS software infrastructure</a></span></dt><dt><span class="section"><a href="#idp54808">Installation prerequisites</a></span></dt><dd><dl><dt><span class="section"><a href="#idp55160">Client side</a></span></dt><dt><span class="section"><a href="#idp57344">Server side</a></span></dt></dl></dd><dt><span class="section"><a href="#idp59656">Job owner and identifier</a></span></dt><dt><span class="section"><a href="#idp68584">Architecture diagrams</a></span></dt><dd><dl><dt><span class="section"><a href="#idp68936">TMS client-side components</a></span></dt><dt><span class="section"><a href="#idp74296">TMS server-side components</a></span></dt><dt><span class="section"><a href="#idp80704">Communication Bus Details</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#idp84224">3. Internal API specification</a></span></dt><dd><dl><dt><span class="section"><a href="#idp84744">Generic definition formats presentation</a></span></dt><dd><dl><dt><span class="section"><a href="#idp85432">Service definition format</a></span></dt></dl></dd><dt><span class="section"><a href="#idp99664">Definition of the services of the package</a></span></dt><dd><dl><dt><span class="section"><a href="#idp100032">Service jobSubmit_MACHINEID</a></span></dt><dt><span class="section"><a href="#idp129096">Service jobCancel_MACHINEID</a></span></dt><dt><span class="section"><a href="#idp156288">Service JobInfo_MACHINEID</a></span></dt><dt><span class="section"><a href="#idp181024">Service getListOfJobs_MACHINEID</a></span></dt><dt><span class="section"><a href="#idp206784">Service getListOfQueues_MACHINEID</a></span></dt><dt><span class="section"><a href="#idp233048">Service getJobsProgression_MACHINEID</a></span></dt><dt><span class="section"><a href="#idp258920">Service jobOutputGetResult_MACHINEID</a></span></dt><dt><span class="section"><a href="#idp287632">Service jobOutputGetCompletedJobs_MACHINEID</a></span></dt><dt><span class="section"><a href="#idp311688">Service jobSubmit_autom</a></span></dt><dt><span class="section"><a href="#idp340104">Service getListOfJobs_all</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#idp365152">4. Internal class and data structures</a></span></dt><dd><dl><dt><span class="section"><a href="#idp365512">Introduction</a></span></dt><dt><span class="section"><a href="#idp370304">TMS client modelization</a></span></dt><dd><dl><dt><span class="section"><a href="#idp370824">Class diagrams</a></span></dt></dl></dd><dt><span class="section"><a href="#idp373496">TMS server modelization</a></span></dt><dd><dl><dt><span class="section"><a href="#idp374016">Class diagrams</a></span></dt></dl></dd><dt><span class="section"><a href="#idp376568">TMS data modelization</a></span></dt><dd><dl><dt><span class="section"><a href="#idp377088">Class diagrams</a></span></dt></dl></dd></dl></dd></dl></div><div class="list-of-figures"><p><b>List of Figures</b></p><dl><dt>2.1. <a href="#idp64488">TMS submitJob sequence: first sequence</a></dt><dt>2.2. <a href="#idp65800">TMS submitJob sequence: second sequence</a></dt><dt>2.3. <a href="#idp67160">TMS submitJob sequence: last sequence</a></dt><dt>2.4. <a href="#idp72880">TMS client-side components</a></dt><dt>2.5. <a href="#idp77944">TMS server-side components</a></dt><dt>2.6. <a href="#idp79296">TMS communication diagram</a></dt><dt>2.7. <a href="#idp82680">Communication Bus Details</a></dt><dt>4.1. <a href="#idp371952">TMS Client Class Diagram</a></dt><dt>4.2. <a href="#idp375024">TMS Server Class Diagram</a></dt><dt>4.3. <a href="#idp378104">TMS Data Class Diagram</a></dt></dl></div><div class="chapter" title="Chapter 1. Document presentation"><div class="titlepage"><div><div><h2 class="title"><a id="idp13464"></a>Chapter 1. Document presentation</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#idp13816">Document objectives</a></span></dt><dt><span class="section"><a href="#idp15536">Document structure</a></span></dt><dt><span class="section"><a href="#idm33544">References</a></span></dt><dt><span class="section"><a href="#idp33984">Acronyms</a></span></dt><dt><span class="section"><a href="#idp40888">Glossary</a></span></dt></dl></div><div class="section" title="Document objectives"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp13816"></a>Document objectives</h2></div></div></div><p> This document presents the detailed internal design of the Tasks Management Service (TMS) module. The purpose of this
        module is to handle all aspects of Tasks Management Service within the VISHNU system. The functional
        and non-functional requirements for this module are those described in the [D1.1a] and [D1.1c] documents (see References). 
        The current
        document is part of the design phase of the software and therefore its main goal is to define the main components of the
        system architecture and their relationships.
      </p></div><div class="section" title="Document structure"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp15536"></a>Document structure</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Chapter 1 contains a brief overview of the document content.</p></li><li class="listitem"><p>Chapter 2 contains a high-level overview of the system architecture except the TMS deployment diagram which is described in [D1.1g] 
             (VISHNU Technical Architecture).</p></li><li class="listitem"><p>Chapter 3 describes the internal API used for remote procedure calls through VISHNU.</p></li><li class="listitem"><p>Chapter 4 describes the internal classes and data structures except the Vishnu core functions modelization which is included in [D2.1a] (VISHNU User Management Service Module Design)</p></li></ul></div></div><div class="section" title="References"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idm33544"></a>References</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>[D1.1a]: VISHNU General specifications</p></li><li class="listitem"><p>[D1.1b]: VISHNU Spécifications techniques des besoins</p></li><li class="listitem"><p>[D1.1c]: VISHNU API Detailed specifications</p></li><li class="listitem"><p>[D1.1g]: VISHNU Technical Architecture</p></li><li class="listitem"><p>[D2.1a]: VISHNU User Management Service Package Design</p></li></ul></div></div><div class="section" title="Acronyms"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp33984"></a>Acronyms</h2></div></div></div><p>
        </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="bold"><strong>API</strong></span>: Application Programming Interface</p></li><li class="listitem"><p><span class="bold"><strong>DB</strong></span>: DataBase</p></li><li class="listitem"><p><span class="bold"><strong>CLI</strong></span>: Command Line Interface</p></li><li class="listitem"><p><span class="bold"><strong>LL</strong></span>: IBM LoadLeveler software</p></li><li class="listitem"><p><span class="bold"><strong>N/A</strong></span>: Not Applicable</p></li><li class="listitem"><p><span class="bold"><strong>SeD</strong></span>: A Server Daemon (VISHNU agent)</p></li><li class="listitem"><p><span class="bold"><strong>SOA</strong></span>: Service Oriented Architecture</p></li><li class="listitem"><p><span class="bold"><strong>TMS</strong></span>: Tasks Management Service</p></li><li class="listitem"><p><span class="bold"><strong>WS</strong></span>: Web Services</p></li></ul></div><p>
      </p></div><div class="section" title="Glossary"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp40888"></a>Glossary</h2></div></div></div><p>
        </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="bold"><strong>Components</strong></span>: the software components represents a library or an executable program that provides a given interface to other components or to end-users.</p></li><li class="listitem"><p><span class="bold"><strong>Serialized type</strong></span>: this is a class of data (C++ Class) which instances can be serialized in a XML string before being sent over an API (to or from the API). The data is deserialized on the other side of the channel in order to re-build the same instance of the class.</p></li></ul></div><p>
      </p></div></div><div class="chapter" title="Chapter 2. System Architecture"><div class="titlepage"><div><div><h2 class="title"><a id="idp43392"></a>Chapter 2. System Architecture</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#idp43712">Overview of the TMS software infrastructure</a></span></dt><dt><span class="section"><a href="#idp54808">Installation prerequisites</a></span></dt><dd><dl><dt><span class="section"><a href="#idp55160">Client side</a></span></dt><dt><span class="section"><a href="#idp57344">Server side</a></span></dt></dl></dd><dt><span class="section"><a href="#idp59656">Job owner and identifier</a></span></dt><dt><span class="section"><a href="#idp68584">Architecture diagrams</a></span></dt><dd><dl><dt><span class="section"><a href="#idp68936">TMS client-side components</a></span></dt><dt><span class="section"><a href="#idp74296">TMS server-side components</a></span></dt><dt><span class="section"><a href="#idp80704">Communication Bus Details</a></span></dt></dl></dd></dl></div><div class="section" title="Overview of the TMS software infrastructure"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp43712"></a>Overview of the TMS software infrastructure</h2></div></div></div><p>We present in this section a detailed description of the TMS package architecture in terms of software components.
        In addition we show the dependencies between components to highlight their reuse. These components follow a SOA model where each
        server publish a set of services that can be used by the clients.
        We present the different software layers from the API (services provided directly to the user) to the database (used by the server). 
        The TMS module is splitted into eight different interrelated components. The diagrams shown in section 2.4 describe
        the relationships between these components. The definitions of the components are the following:
       </p><p>
        </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="bold"><strong>External API</strong></span>
             publishes the services provided locally to the user as defined in the detailed specifications. The external API is
             actually implemented in C++ but wrapping layers are provided for the Python language and for Web Services.
            </p></li><li class="listitem"><p><span class="bold"><strong>Internal API</strong></span>
             publishes the services provided by the servers.
            </p></li><li class="listitem"><p><span class="bold"><strong>TMS Client</strong></span>
            contains intermediate (proxy) classes providing remote access to the business objects of <span class="bold"><strong>TMS Server</strong></span>.
            </p></li><li class="listitem"><p><span class="bold"><strong>TMS Server</strong></span>
             contains all classes implementing business objects that process requests sent by the TMS Client. 
              It loads plugins implementing the different interfaces with all the supported batch schedulers.
            </p></li><li class="listitem"><p><span class="bold"><strong>TMS Monitor Daemon</strong></span>
             which the only role is to keep an eye on the job state execution time by checking the status parameter of job table 
in the Vishnu Database.
            </p></li><li class="listitem"><p>We need one of the following batch schedulers (see STB for details)</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p><span class="bold"><strong>Torque API </strong></span> is the C API provided by the Torque batch scheduler.
                </p></li><li class="listitem"><p><span class="bold"><strong>LoadLeveler API </strong></span> is the C API provided by the IBM LoadLeveler batch scheduler..
                </p></li><li class="listitem"><p><span class="bold"><strong>SLURM API </strong></span> is the C API provided by the SLURM batch scheduler..
                </p></li><li class="listitem"><p><span class="bold"><strong>LSF API </strong></span> is the C API provided by the LSF batch scheduler..
                </p></li><li class="listitem"><p><span class="bold"><strong>DRMAA API </strong></span> is the C API provided by drmaa for the Grid Engine batch scheduler..
                </p></li></ul></div></li><li class="listitem"><p><span class="bold"><strong>Vishnu Database</strong></span> stores all data manipulated by the TMS Server.
            </p></li></ul></div><p>
      </p></div><div class="section" title="Installation prerequisites"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp54808"></a>Installation prerequisites</h2></div></div></div><div class="section" title="Client side"><div class="titlepage"><div><div><h3 class="title"><a id="idp55160"></a>Client side</h3></div></div></div><p>The installation of TMS module on the client needs the following libraries: </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>VISHNU UMS libraries: the VISHNU User Management Service that allow the session creation and user authentification.
            </p></li><li class="listitem"><p>C++ and Boost-C++ libraries </p></li><li class="listitem"><p> ZMQ </p></li></ul></div></div><div class="section" title="Server side"><div class="titlepage"><div><div><h3 class="title"><a id="idp57344"></a>Server side</h3></div></div></div><p>The installation of TMS module on the server side needs the following libraries:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>VISHNU UMS libraries: the VISHNU User Management Service that allow the session creation and user authentification.
            </p></li><li class="listitem"><p>C++ and Boost-C++ libraries</p></li><li class="listitem"><p>A library of a batch scheduler (see STB for detail):
           </p></li></ul></div></div></div><div class="section" title="Job owner and identifier"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp59656"></a>Job owner and identifier</h2></div></div></div><p> Each TMS server process runs using a specific local system account dedicated to VISHNU. To allow a TMS server to submit jobs with a user local account on the machine on which the TMS server runs, the TMS server calls an other service and asks the executor of the service to submit the job. We call this service executor  <span class="emphasis"><em>tmsSlave</em></span>.  <span class="emphasis"><em>tmsSlave</em></span> uses <span class="emphasis"><em>ssh executable command</em></span> by switching the local system account dedicated to VISHNU to user local account, and after connexion on the user local account it calls the underlying batch scheduler API. For example a job submitted by user jdupond on a machine dedicated to LoadLeveler will be visible as a job with identifier "hostname.344.0" and owner "jdupond". 
         From the VISHNU user point of view, the job owner corresponds of user job owner on the submitted machine and the  job identifier will be hidden and replaced by the generate global job identifier by VISHNU. For example the previous job will be visible in VISHNU as job "JOB_6767" and userId "jdupond".</p><p>This data translation is entirely transparent to the VISHNU user and simplifies job management. </p><p>This <span class="emphasis"><em>tmsSlave</em></span> is used only by two services: <span class="emphasis"><em>submitJob</em></span> service and <span class="emphasis"><em>cancelJob</em></span> service. </p><p>The figures 2.1, 2.2 and 2.3 show the diagram sequence of TMS submitJob using <span class="emphasis"><em>tmsSlave</em></span>. </p><div class="figure"><a id="idp64488"></a><p class="title"><b>Figure 2.1. TMS submitJob sequence: first sequence</b></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/png/submitJobSequence1.png" align="middle" alt="TMS submitJob sequence: first sequence" /></div></div></div><br class="figure-break" /><div class="figure"><a id="idp65800"></a><p class="title"><b>Figure 2.2. TMS submitJob sequence: second sequence</b></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/png/submitJobSequence2.png" align="middle" alt="TMS submitJob sequence: second sequence" /></div></div></div><br class="figure-break" /><div class="figure"><a id="idp67160"></a><p class="title"><b>Figure 2.3. TMS submitJob sequence: last sequence</b></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/png/submitJobSequence3.png" align="middle" alt="TMS submitJob sequence: last sequence" /></div></div></div><br class="figure-break" /></div><div class="section" title="Architecture diagrams"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp68584"></a>Architecture diagrams</h2></div></div></div><div class="section" title="TMS client-side components"><div class="titlepage"><div><div><h3 class="title"><a id="idp68936"></a>TMS client-side components</h3></div></div></div><p>This diagram shows the TMS client side components. Two services among all the services of the TMS external API (see ref. D1.1c) are shown here for example. These services are consumed by serval user interfaces: command-line, web services and python. All the interfaces of the TMS Client component are shown. The TMS client component provides four classes which are defined below:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="bold"><strong>JobProxy</strong></span>
             provides the services that allow to submit, to cancel a job and to get information on a  job.
            </p></li><li class="listitem"><p><span class="bold"><strong>QueryProxy</strong></span> provides a generic service that allows to get job information (list of all submitted jobs, information on a specific given job and jobs'progression) and to list all availables queues on a given machine.</p></li><li class="listitem"><p><span class="bold"><strong>JobOutPutProxy</strong></span> provides the services that allow to get the results of all finished jobs or a specific given job.</p></li></ul></div><div class="figure"><a id="idp72880"></a><p class="title"><b>Figure 2.4. TMS client-side components</b></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/png/TMS_client-side_components.png" align="middle" alt="TMS client-side components" /></div></div></div><br class="figure-break" /></div><div class="section" title="TMS server-side components"><div class="titlepage"><div><div><h3 class="title"><a id="idp74296"></a>TMS server-side components</h3></div></div></div><p>This diagram highlights the TMS server side components. Two services among all the services of the TMS internal API are shown here for example. All the interfaces of the TMS Server component are shown. Nevertheless, it is possible to use TMS without underlying batch scheduler. In this case, the scripts is executed as a classic shell script, it is important to note that this pseudo batch is always available, even when other API are used, but by default not used).</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="bold"><strong>JobServer</strong></span>
             resolves the services that allow to submit, to cancel a job and to get information on a job.
            </p></li><li class="listitem"><p><span class="bold"><strong>QueryServer</strong></span> resolves a generic service that allows to get job information (list of all submitted jobs, information on a specific given job and jobs progression) and to list all availables queues on a given machine.</p></li><li class="listitem"><p><span class="bold"><strong>JobOutPutServer</strong></span> resolves the services that allow to get the results of all finished jobs or a specific given job.</p></li></ul></div><div class="figure"><a id="idp77944"></a><p class="title"><b>Figure 2.5. TMS server-side components</b></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/png/TMS_server-side_components.png" align="middle" alt="TMS server-side components" /></div></div></div><br class="figure-break" /><div class="figure"><a id="idp79296"></a><p class="title"><b>Figure 2.6. TMS communication diagram</b></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/png/tms_organisation.jpg" align="middle" alt="TMS communication diagram" /></div></div></div><br class="figure-break" /></div><div class="section" title="Communication Bus Details"><div class="titlepage"><div><div><h3 class="title"><a id="idp80704"></a>Communication Bus Details</h3></div></div></div><p> This diagram shows the communication paths between the Client host and the TMS servers using the communication Bus. On each remote VISHNU machine on which a batch scheduler library and API are installed a TMS server must be launched (for example in the figure 2.7 we have seven TMS servers launched on seven different nodes). The dispatcher is an optional VISHNU agent that can be executed on a dedicated host or on the same host as the TMS Server. All the communications between the entities here are done using ZMQ librarie and the communications can be tunneled through SSH tunnels if necessary. The diagram shows here all the communication paths in the case where the TMS Server2 is chosen by the dispatcher.</p><div class="figure"><a id="idp82680"></a><p class="title"><b>Figure 2.7. Communication Bus Details</b></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/png/TMS_SysFera-DS_Bus_Details.png" align="middle" alt="Communication Bus Details" /></div></div></div><br class="figure-break" /></div></div></div><div class="chapter" title="Chapter 3. Internal API specification"><div class="titlepage"><div><div><h2 class="title"><a id="idp84224"></a>Chapter 3. Internal API specification</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#idp84744">Generic definition formats presentation</a></span></dt><dd><dl><dt><span class="section"><a href="#idp85432">Service definition format</a></span></dt></dl></dd><dt><span class="section"><a href="#idp99664">Definition of the services of the package</a></span></dt><dd><dl><dt><span class="section"><a href="#idp100032">Service jobSubmit_MACHINEID</a></span></dt><dt><span class="section"><a href="#idp129096">Service jobCancel_MACHINEID</a></span></dt><dt><span class="section"><a href="#idp156288">Service JobInfo_MACHINEID</a></span></dt><dt><span class="section"><a href="#idp181024">Service getListOfJobs_MACHINEID</a></span></dt><dt><span class="section"><a href="#idp206784">Service getListOfQueues_MACHINEID</a></span></dt><dt><span class="section"><a href="#idp233048">Service getJobsProgression_MACHINEID</a></span></dt><dt><span class="section"><a href="#idp258920">Service jobOutputGetResult_MACHINEID</a></span></dt><dt><span class="section"><a href="#idp287632">Service jobOutputGetCompletedJobs_MACHINEID</a></span></dt><dt><span class="section"><a href="#idp311688">Service jobSubmit_autom</a></span></dt><dt><span class="section"><a href="#idp340104">Service getListOfJobs_all</a></span></dt></dl></dd></dl></div><div class="section" title="Generic definition formats presentation"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp84744"></a>Generic definition formats presentation</h2></div></div></div><p>This section presents the formats used in this chapter to describe the services provided
            by the internal API.</p><div class="section" title="Service definition format"><div class="titlepage"><div><div><h3 class="title"><a id="idp85432"></a>Service definition format</h3></div></div></div><p><span class="bold"><strong>Access </strong></span></p><p>Here is detailed the access level of the service 'myService' (i.e. the privilege required to use it)</p><p><span class="bold"><strong>Parameters</strong></span></p><p>The following table contains all the input and output parameters of the service, along with their type and description.</p><div class="informaltable"><table border="1"><colgroup><col width="2cm" /><col width="2cm" /><col width="3cm" /><col width="8cm" /><col width="1cm" /></colgroup><thead><tr><th>Parameter</th><th>Type</th><th>Serialized type</th><th>Description</th><th>Mode</th></tr></thead><tbody><tr><td><p>sessionKey</p></td><td><p>string</p></td><td><p>n/a</p></td><td><p>This is an example of a required string input parameter</p></td><td><p>IN</p></td></tr><tr><td><p>listOfJobs</p></td><td><p>string</p></td><td><p>ListJobs</p></td><td><p>This is an example of an object output parameter that is serialized as a string</p></td><td><p>OUT</p></td></tr></tbody></table></div><p><span class="bold"><strong>Description </strong></span></p><p>Here is detailed the purpose of the service 'myService'</p><p><span class="bold"><strong>Return Value </strong></span></p><p>Here are detailed the different return codes provided by the service.</p><div class="informaltable"><table border="1"><colgroup><col width="8.5cm" /><col width="9cm" /></colgroup><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><p>ERRCODE_VISHNU_OK</p></td><td><p>The service has been performed successfully.</p></td></tr><tr><td><p>ERRCODE_UNKNOWN_MACHINE</p></td><td><p>This is the human-readable generic message that will be available to the user of the API.</p></td></tr></tbody></table></div><p><span class="bold"><strong>Used by this(these) API function(s): </strong></span></p><p>This shows the list of functions from the external Vishnu API (see [D1_1c]) that use this service.</p></div></div><div class="section" title="Definition of the services of the package"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp99664"></a>Definition of the services of the package</h2></div></div></div><div class="section" title="Service jobSubmit_MACHINEID"><div class="titlepage"><div><div><h3 class="title"><a id="idp100032"></a>Service jobSubmit_MACHINEID</h3></div></div></div><p><span class="bold"><strong>Access</strong></span></p><p>This service can be used by any VISHNU user</p><p><span class="bold"><strong>Parameters</strong></span></p><div class="informaltable"><table border="1"><colgroup><col width="2cm" /><col width="2cm" /><col width="3cm" /><col width="8cm" /><col width="1cm" /></colgroup><thead><tr><th>Parameter</th><th>Type</th><th>Serialized type</th><th>Description</th><th>Mode</th></tr></thead><tbody><tr><td><p>sessionKey</p></td><td><p>string</p></td><td><p>n/a</p></td><td><p>The session key  is the encrypted identifier of the session generated by VISHNU</p></td><td><p>IN</p></td></tr><tr><td><p>machineId</p></td><td><p>string</p></td><td><p>n/a</p></td><td><p>Is the id of the machine on which  the job must be submitted</p></td><td><p>IN</p></td></tr><tr><td><p>scriptContent</p></td><td><p>string</p></td><td><p>n/a</p></td><td><p>Is the content of the script  to  submit</p></td><td><p>IN</p></td></tr><tr><td><p>options</p></td><td><p>string</p></td><td><p><a class="link" href="#">SubmitOptions</a></p></td><td><p>Is an instance of the class SubmitOptions. It allows the user to submit job by using different options</p></td><td><p>IN</p></td></tr><tr><td><p>job</p></td><td><p>string</p></td><td><p><a class="link" href="#">Job</a></p></td><td><p>The  Job object containing the input information (ex: jobPath) and output information (ex:  jobId) of the job to submit</p></td><td><p>INOUT</p></td></tr><tr><td><p>errorInfo</p></td><td><p>string</p></td><td><p>n/a</p></td><td><p>Additional information provided when an error code is returned</p></td><td><p>OUT</p></td></tr></tbody></table></div><p><span class="bold"><strong>Description </strong></span></p><p>The jobSubmit_MACHINEID() function submits job on a machine of identifier MACHINEID through the use of a script (scriptContent)</p><p><span class="bold"><strong>Return Value </strong></span></p><p>An error code is returned when an error occurs during the execution of the service</p><div class="informaltable"><table border="1"><colgroup><col width="8.5cm" /><col width="9cm" /></colgroup><thead><tr><th>Name
</th><th>Description
</th></tr></thead><tbody><tr><td><p>VISHNU_OK</p></td><td><p>The service was performed  successfully</p></td></tr><tr><td><p>ERRCODE_INVALID_PARAM</p></td><td><p>Error invalid parameters</p></td></tr><tr><td><p>ERRCODE_SESSIONKEY_EXPIRED</p></td><td><p>The sessionKey is expired. The session is closed.</p></td></tr><tr><td><p>ERRCODE_SESSIONKEY_NOT_FOUND</p></td><td><p>The session key is unrecognized</p></td></tr><tr><td><p>ERRCODE_BATCH_SCHEDULER_ERROR</p></td><td><p>The batch scheduler indicates an error</p></td></tr><tr><td><p>ERRCODE_SSH</p></td><td><p>Vishnu not available (SSH error)</p></td></tr><tr><td><p>ERRCODE_SYSTEM</p></td><td><p>Vishnu not available (System)</p></td></tr><tr><td><p>ERRCODE_UNDEFINED</p></td><td><p>Internal Error: Undefined exception</p></td></tr><tr><td><p>ERRCODE_UNKNOWN_SESSION_ID</p></td><td><p>The session Id is unknown</p></td></tr><tr><td><p>ERRCODE_UNKNOWN_MACHINE</p></td><td><p>The machine id is unknown</p></td></tr><tr><td><p>ERRCODE_DIET</p></td><td><p>Vishnu not available (Service bus failure)</p></td></tr><tr><td><p>ERRCODE_DBERR</p></td><td><p>Vishnu not available (Database error)</p></td></tr><tr><td><p>ERRCODE_DBCONN</p></td><td><p>Vishnu not available (Database connection)</p></td></tr></tbody></table></div><p><span class="bold"><strong>Used by this(these) API function(s): </strong></span></p><p>TMS::submitJob</p></div><div class="section" title="Service jobCancel_MACHINEID"><div class="titlepage"><div><div><h3 class="title"><a id="idp129096"></a>Service jobCancel_MACHINEID</h3></div></div></div><p><span class="bold"><strong>Access</strong></span></p><p>This service can be used by any VISHNU user</p><p><span class="bold"><strong>Parameters</strong></span></p><div class="informaltable"><table border="1"><colgroup><col width="2cm" /><col width="2cm" /><col width="3cm" /><col width="8cm" /><col width="1cm" /></colgroup><thead><tr><th>Parameter</th><th>Type</th><th>Serialized type</th><th>Description</th><th>Mode</th></tr></thead><tbody><tr><td><p>sessionKey</p></td><td><p>string</p></td><td><p>n/a</p></td><td><p>The session key is the encrypted identifier of the session generated by VISHNU</p></td><td><p>IN</p></td></tr><tr><td><p>machineId</p></td><td><p>string</p></td><td><p>n/a</p></td><td><p>Is the id of the machine on which  the job is running</p></td><td><p>IN</p></td></tr><tr><td><p>job</p></td><td><p>string</p></td><td><p><a class="link" href="#">Job</a></p></td><td><p>The  Job object containing the input information (ex: jobId)</p></td><td><p>IN</p></td></tr><tr><td><p>errorInfo</p></td><td><p>string</p></td><td><p>n/a</p></td><td><p>Additional information provided when an error code is returned</p></td><td><p>OUT</p></td></tr></tbody></table></div><p><span class="bold"><strong>Description </strong></span></p><p>The jobCancel_MACHINEID() function cancels a job submitted on machine of identifier MACHINEID . If job id is equal to all, all submitted jobs by all users will be cancelled if the user is an administrator, and only jobs submitted by the user will be cancelled if the user is not an administrator.</p><p><span class="bold"><strong>Return Value </strong></span></p><p>An error code is returned when an error occurs during the execution of the service</p><div class="informaltable"><table border="1"><colgroup><col width="8.5cm" /><col width="9cm" /></colgroup><thead><tr><th>Name
</th><th>Description
</th></tr></thead><tbody><tr><td><p>VISHNU_OK</p></td><td><p>The service was performed  successfully</p></td></tr><tr><td><p>ERRCODE_SESSIONKEY_EXPIRED</p></td><td><p>The sessionKey is expired. The session is closed.</p></td></tr><tr><td><p>ERRCODE_SESSIONKEY_NOT_FOUND</p></td><td><p>The session key is unrecognized</p></td></tr><tr><td><p>ERRCODE_BATCH_SCHEDULER_ERROR</p></td><td><p>The batch scheduler indicates an error</p></td></tr><tr><td><p>ERRCODE_ALREADY_CANCELED</p></td><td><p>The job is already canceled</p></td></tr><tr><td><p>ERRCODE_UNKNOWN_JOBID</p></td><td><p>The job id is unknown</p></td></tr><tr><td><p>ERRCODE_UNKNOWN_SESSION_ID</p></td><td><p>The session Id is unknown</p></td></tr><tr><td><p>ERRCODE_UNKNOWN_MACHINE</p></td><td><p>The machine id is unknown</p></td></tr><tr><td><p>ERRCODE_PERMISSION_DENIED</p></td><td><p>Permission denied</p></td></tr><tr><td><p>ERRCODE_DIET</p></td><td><p>Vishnu not available (Service bus failure)</p></td></tr><tr><td><p>ERRCODE_DBERR</p></td><td><p>Vishnu not available (Database error)</p></td></tr><tr><td><p>ERRCODE_DBCONN</p></td><td><p>Vishnu not available (Database connection)</p></td></tr><tr><td><p>ERRCODE_UNDEFINED</p></td><td><p>Internal Error: Undefined exception</p></td></tr><tr><td><p>ERRCODE_SYSTEM</p></td><td><p>Vishnu not available (System)</p></td></tr><tr><td><p>ERRCODE_SSH</p></td><td><p>Vishnu not available (SSH error)</p></td></tr></tbody></table></div><p><span class="bold"><strong>Used by this(these) API function(s): </strong></span></p><p>TMS::cancelJob</p></div><div class="section" title="Service JobInfo_MACHINEID"><div class="titlepage"><div><div><h3 class="title"><a id="idp156288"></a>Service JobInfo_MACHINEID</h3></div></div></div><p><span class="bold"><strong>Access</strong></span></p><p>This service can be used by any VISHNU user</p><p><span class="bold"><strong>Parameters</strong></span></p><div class="informaltable"><table border="1"><colgroup><col width="2cm" /><col width="2cm" /><col width="3cm" /><col width="8cm" /><col width="1cm" /></colgroup><thead><tr><th>Parameter</th><th>Type</th><th>Serialized type</th><th>Description</th><th>Mode</th></tr></thead><tbody><tr><td><p>sessionKey</p></td><td><p>string</p></td><td><p>n/a</p></td><td><p> The session key is the encrypted identifier of the session generated by VISHNU</p></td><td><p>IN</p></td></tr><tr><td><p>machineId</p></td><td><p>string</p></td><td><p>n/a</p></td><td><p>Is the id of the machine on which  the job is running</p></td><td><p>IN</p></td></tr><tr><td><p>job</p></td><td><p>string</p></td><td><p><a class="link" href="#">Job</a></p></td><td><p>The  Job object containing the input information (ex: jobId) and the resulting information</p></td><td><p>INOUT</p></td></tr><tr><td><p>errorInfo</p></td><td><p>string</p></td><td><p>n/a</p></td><td><p>Additional information provided when an error code is returned</p></td><td><p>OUT</p></td></tr></tbody></table></div><p><span class="bold"><strong>Description </strong></span></p><p>The JobInfo_MACHINEID() function gets information on a job  submitted on machine of identifier MACHINEID</p><p><span class="bold"><strong>Return Value </strong></span></p><p>An error code is returned when an error occurs during the execution of the service</p><div class="informaltable"><table border="1"><colgroup><col width="8.5cm" /><col width="9cm" /></colgroup><thead><tr><th>Name
</th><th>Description
</th></tr></thead><tbody><tr><td><p>VISHNU_OK</p></td><td><p>The service was performed  successfully</p></td></tr><tr><td><p>ERRCODE_JOB_IS_NOT_TERMINATED</p></td><td><p>The job is not terminated</p></td></tr><tr><td><p>ERRCODE_SESSIONKEY_EXPIRED</p></td><td><p>The sessionKey is expired. The session is closed.</p></td></tr><tr><td><p>ERRCODE_SESSIONKEY_NOT_FOUND</p></td><td><p>The session key is unrecognized</p></td></tr><tr><td><p>ERRCODE_UNKNOWN_JOBID</p></td><td><p>The job id is unknown</p></td></tr><tr><td><p>ERRCODE_UNKNOWN_MACHINE</p></td><td><p>The machine id is unknown</p></td></tr><tr><td><p>ERRCODE_UNKNOWN_SESSION_ID</p></td><td><p>The session Id is unknown</p></td></tr><tr><td><p>ERRCODE_UNDEFINED</p></td><td><p>Internal Error: Undefined exception</p></td></tr><tr><td><p>ERRCODE_DIET</p></td><td><p>Vishnu not available (Service bus failure)</p></td></tr><tr><td><p>ERRCODE_DBERR</p></td><td><p>Vishnu not available (Database error)</p></td></tr><tr><td><p>ERRCODE_DBCONN</p></td><td><p>Vishnu not available (Database connection)</p></td></tr><tr><td><p>ERRCODE_SYSTEM</p></td><td><p>Vishnu not available (System)</p></td></tr></tbody></table></div><p><span class="bold"><strong>Used by this(these) API function(s): </strong></span></p><p>TMS::getJobInfo</p></div><div class="section" title="Service getListOfJobs_MACHINEID"><div class="titlepage"><div><div><h3 class="title"><a id="idp181024"></a>Service getListOfJobs_MACHINEID</h3></div></div></div><p><span class="bold"><strong>Access</strong></span></p><p>This service can be used by any VISHNU user</p><p><span class="bold"><strong>Parameters</strong></span></p><div class="informaltable"><table border="1"><colgroup><col width="2cm" /><col width="2cm" /><col width="3cm" /><col width="8cm" /><col width="1cm" /></colgroup><thead><tr><th>Parameter</th><th>Type</th><th>Serialized type</th><th>Description</th><th>Mode</th></tr></thead><tbody><tr><td><p>sessionKey</p></td><td><p>string</p></td><td><p>n/a</p></td><td><p> The session key is the encrypted identifier of the session generated by VISHNU</p></td><td><p>IN</p></td></tr><tr><td><p>machineId</p></td><td><p>string</p></td><td><p>n/a</p></td><td><p>Is the id of the machine on which  the jobs are running</p></td><td><p>IN</p></td></tr><tr><td><p>options</p></td><td><p>string</p></td><td><p><a class="link" href="#">ListJobsOptions</a></p></td><td><p>Additional options for jobs listing</p></td><td><p>IN</p></td></tr><tr><td><p>listOfJobs</p></td><td><p>string</p></td><td><p><a class="link" href="#">ListJobs</a></p></td><td><p>The constructed object list of jobs</p></td><td><p>OUT</p></td></tr><tr><td><p>errorInfo</p></td><td><p>string</p></td><td><p>n/a</p></td><td><p>Additional information provided when an error code is returned</p></td><td><p>OUT</p></td></tr></tbody></table></div><p><span class="bold"><strong>Description </strong></span></p><p>The getListOfJobs_MACHINEID() function gets a list of all submitted jobs submitted on machine of identifier MACHINEID</p><p><span class="bold"><strong>Return Value </strong></span></p><p>An error code is returned when an error occurs during the execution of the service</p><div class="informaltable"><table border="1"><colgroup><col width="8.5cm" /><col width="9cm" /></colgroup><thead><tr><th>Name
</th><th>Description
</th></tr></thead><tbody><tr><td><p>VISHNU_OK</p></td><td><p>The service was performed  successfully</p></td></tr><tr><td><p>ERRCODE_UNKNOWN_SESSION_ID</p></td><td><p>The session Id is unknown</p></td></tr><tr><td><p>ERRCODE_UNKNOWN_MACHINE</p></td><td><p>The machine id is unknown</p></td></tr><tr><td><p>ERRCODE_BATCH_SCHEDULER_ERROR</p></td><td><p>The batch scheduler indicates an error</p></td></tr><tr><td><p>ERRCODE_DBCONN</p></td><td><p>Vishnu not available (Database connection)</p></td></tr><tr><td><p>ERRCODE_DBERR</p></td><td><p>Vishnu not available (Database error)</p></td></tr><tr><td><p>ERRCODE_DIET</p></td><td><p>Vishnu not available (Service bus failure)</p></td></tr><tr><td><p>ERRCODE_SYSTEM</p></td><td><p>Vishnu not available (System)</p></td></tr><tr><td><p>ERRCODE_UNDEFINED</p></td><td><p>Internal Error: Undefined exception</p></td></tr><tr><td><p>ERRCODE_SESSIONKEY_NOT_FOUND</p></td><td><p>The session key is unrecognized</p></td></tr><tr><td><p>ERRCODE_SESSIONKEY_EXPIRED</p></td><td><p>The sessionKey is expired. The session is closed.</p></td></tr></tbody></table></div><p><span class="bold"><strong>Used by this(these) API function(s): </strong></span></p><p>TMS::listJobs</p></div><div class="section" title="Service getListOfQueues_MACHINEID"><div class="titlepage"><div><div><h3 class="title"><a id="idp206784"></a>Service getListOfQueues_MACHINEID</h3></div></div></div><p><span class="bold"><strong>Access</strong></span></p><p>This service can be used by any VISHNU user</p><p><span class="bold"><strong>Parameters</strong></span></p><div class="informaltable"><table border="1"><colgroup><col width="2cm" /><col width="2cm" /><col width="3cm" /><col width="8cm" /><col width="1cm" /></colgroup><thead><tr><th>Parameter</th><th>Type</th><th>Serialized type</th><th>Description</th><th>Mode</th></tr></thead><tbody><tr><td><p>sessionKey</p></td><td><p>string</p></td><td><p>n/a</p></td><td><p>The session key  is the encrypted identifier of the session generated by VISHNU</p></td><td><p>IN</p></td></tr><tr><td><p>machineId</p></td><td><p>string</p></td><td><p>n/a</p></td><td><p>Is the id of the machine that the user wants to list queues</p></td><td><p>IN</p></td></tr><tr><td><p>queueName</p></td><td><p>string</p></td><td><p>n/a</p></td><td><p>The name of queue to query</p></td><td><p>IN</p></td></tr><tr><td><p>listofQueues</p></td><td><p>string</p></td><td><p><a class="link" href="#">ListQueues</a></p></td><td><p>The list of queues</p></td><td><p>OUT</p></td></tr><tr><td><p>errorInfo</p></td><td><p>string</p></td><td><p>n/a</p></td><td><p>Additional information provided when an error code is returned</p></td><td><p>OUT</p></td></tr></tbody></table></div><p><span class="bold"><strong>Description </strong></span></p><p>The getListOfQueues_MACHINEID() function gets queues information of the  machine identified by MACHINEID</p><p><span class="bold"><strong>Return Value </strong></span></p><p>An error code is returned when an error occurs during the execution of the service</p><div class="informaltable"><table border="1"><colgroup><col width="8.5cm" /><col width="9cm" /></colgroup><thead><tr><th>Name
</th><th>Description
</th></tr></thead><tbody><tr><td><p>VISHNU_OK</p></td><td><p>The service was performed  successfully</p></td></tr><tr><td><p>ERRCODE_BATCH_SCHEDULER_ERROR</p></td><td><p>The batch scheduler indicates an error</p></td></tr><tr><td><p>ERRCODE_DBCONN</p></td><td><p>Vishnu not available (Database connection)</p></td></tr><tr><td><p>ERRCODE_DBERR</p></td><td><p>Vishnu not available (Database error)</p></td></tr><tr><td><p>ERRCODE_DIET</p></td><td><p>Vishnu not available (Service bus failure)</p></td></tr><tr><td><p>ERRCODE_SESSIONKEY_EXPIRED</p></td><td><p>The sessionKey is expired. The session is closed.</p></td></tr><tr><td><p>ERRCODE_SESSIONKEY_NOT_FOUND</p></td><td><p>The session key is unrecognized</p></td></tr><tr><td><p>ERRCODE_SYSTEM</p></td><td><p>Vishnu not available (System)</p></td></tr><tr><td><p>ERRCODE_UNDEFINED</p></td><td><p>Internal Error: Undefined exception</p></td></tr><tr><td><p>ERRCODE_INVALID_PARAM</p></td><td><p>Error invalid parameters</p></td></tr><tr><td><p>ERRCODE_UNKNOWN_SESSION_ID</p></td><td><p>The session Id is unknown</p></td></tr><tr><td><p>ERRCODE_UNKNOWN_MACHINE</p></td><td><p>The machine id is unknown</p></td></tr></tbody></table></div><p><span class="bold"><strong>Used by this(these) API function(s): </strong></span></p><p>TMS::listQueues</p></div><div class="section" title="Service getJobsProgression_MACHINEID"><div class="titlepage"><div><div><h3 class="title"><a id="idp233048"></a>Service getJobsProgression_MACHINEID</h3></div></div></div><p><span class="bold"><strong>Access</strong></span></p><p>This service can be used by any VISHNU user</p><p><span class="bold"><strong>Parameters</strong></span></p><div class="informaltable"><table border="1"><colgroup><col width="2cm" /><col width="2cm" /><col width="3cm" /><col width="8cm" /><col width="1cm" /></colgroup><thead><tr><th>Parameter</th><th>Type</th><th>Serialized type</th><th>Description</th><th>Mode</th></tr></thead><tbody><tr><td><p>sessionKey</p></td><td><p>string</p></td><td><p>n/a</p></td><td><p> The session key  is the encrypted identifier of the session generated by VISHNU</p></td><td><p>IN</p></td></tr><tr><td><p>machineId</p></td><td><p>string</p></td><td><p>n/a</p></td><td><p>Is the id of the machine that the user wants to get jobs progression</p></td><td><p>IN</p></td></tr><tr><td><p>options</p></td><td><p>string</p></td><td><p><a class="link" href="#">ProgressOptions</a></p></td><td><p>Is an object containing the available options jobs for progression</p></td><td><p>IN</p></td></tr><tr><td><p>listOfProgress</p></td><td><p>string</p></td><td><p><a class="link" href="#">ListProgression</a></p></td><td><p>Is the object containing jobs progression information</p></td><td><p>OUT</p></td></tr><tr><td><p>errorInfo</p></td><td><p>string</p></td><td><p>n/a</p></td><td><p>Additional information provided when an error code is returned</p></td><td><p>OUT</p></td></tr></tbody></table></div><p><span class="bold"><strong>Description </strong></span></p><p>The getJobsProgression_MACHINEID() function gets the progression status of jobs submitted on machine of identifier MACHINEID</p><p><span class="bold"><strong>Return Value </strong></span></p><p>An error code is returned when an error occurs during the execution of the service</p><div class="informaltable"><table border="1"><colgroup><col width="8.5cm" /><col width="9cm" /></colgroup><thead><tr><th>Name
</th><th>Description
</th></tr></thead><tbody><tr><td><p>VISHNU_OK</p></td><td><p>The service was performed  successfully</p></td></tr><tr><td><p>ERRCODE_BATCH_SCHEDULER_ERROR</p></td><td><p>The batch scheduler indicates an error</p></td></tr><tr><td><p>ERRCODE_DBCONN</p></td><td><p>Vishnu not available (Database connection)</p></td></tr><tr><td><p>ERRCODE_DBERR</p></td><td><p>Vishnu not available (Database error)</p></td></tr><tr><td><p>ERRCODE_DIET</p></td><td><p>Vishnu not available (Service bus failure)</p></td></tr><tr><td><p>ERRCODE_SESSIONKEY_EXPIRED</p></td><td><p>The sessionKey is expired. The session is closed.</p></td></tr><tr><td><p>ERRCODE_SESSIONKEY_NOT_FOUND</p></td><td><p>The session key is unrecognized</p></td></tr><tr><td><p>ERRCODE_SYSTEM</p></td><td><p>Vishnu not available (System)</p></td></tr><tr><td><p>ERRCODE_UNDEFINED</p></td><td><p>Internal Error: Undefined exception</p></td></tr><tr><td><p>ERRCODE_UNKNOWN_MACHINE</p></td><td><p>The machine id is unknown</p></td></tr><tr><td><p>ERRCODE_UNKNOWN_SESSION_ID</p></td><td><p>The session Id is unknown</p></td></tr></tbody></table></div><p><span class="bold"><strong>Used by this(these) API function(s): </strong></span></p><p>TMS::getJobProgress</p></div><div class="section" title="Service jobOutputGetResult_MACHINEID"><div class="titlepage"><div><div><h3 class="title"><a id="idp258920"></a>Service jobOutputGetResult_MACHINEID</h3></div></div></div><p><span class="bold"><strong>Access</strong></span></p><p>This service can be used by any VISHNU user</p><p><span class="bold"><strong>Parameters</strong></span></p><div class="informaltable"><table border="1"><colgroup><col width="2cm" /><col width="2cm" /><col width="3cm" /><col width="8cm" /><col width="1cm" /></colgroup><thead><tr><th>Parameter</th><th>Type</th><th>Serialized type</th><th>Description</th><th>Mode</th></tr></thead><tbody><tr><td><p>sessionKey</p></td><td><p>string</p></td><td><p>n/a</p></td><td><p>The session key is the encrypted identifier of the session generated by VISHNU</p></td><td><p>IN</p></td></tr><tr><td><p>machineId</p></td><td><p>string</p></td><td><p>n/a</p></td><td><p>Is the id of the machine on which  the jobs has been submitted</p></td><td><p>IN</p></td></tr><tr><td><p>result</p></td><td><p>string</p></td><td><p><a class="link" href="#">JobResult</a></p></td><td><p>The  Job object containing the input information (ex: jobId)</p></td><td><p>IN</p></td></tr><tr><td><p>errorInfo</p></td><td><p>string</p></td><td><p>n/a</p></td><td><p>Additional information provided when an error code is returned</p></td><td><p>OUT</p></td></tr><tr><td><p>containerId</p></td><td><p>char*</p></td><td><p>n/a</p></td><td><p>Is the identifier of the diet container which contains the job output and error paths</p></td><td><p>OUT</p></td></tr></tbody></table></div><p><span class="bold"><strong>Description </strong></span></p><p>The jobOutputGetResult_MACHINEID() function gets outputPath and errorPath of a job submitted on machine of identifer MACHINEID</p><p><span class="bold"><strong>Return Value </strong></span></p><p>An error code is returned when an error occurs during the execution of the service</p><div class="informaltable"><table border="1"><colgroup><col width="8.5cm" /><col width="9cm" /></colgroup><thead><tr><th>Name
</th><th>Description
</th></tr></thead><tbody><tr><td><p>VISHNU_OK</p></td><td><p>The service was performed  successfully</p></td></tr><tr><td><p>ERRCODE_ALREADY_CANCELED</p></td><td><p>The job is already canceled</p></td></tr><tr><td><p>ERRCODE_ALREADY_DOWNLOADED</p></td><td><p>The job is already downloaded</p></td></tr><tr><td><p>ERRCODE_BATCH_SCHEDULER_ERROR</p></td><td><p>The batch scheduler indicates an error</p></td></tr><tr><td><p>ERRCODE_DBCONN</p></td><td><p>Vishnu not available (Database connection)</p></td></tr><tr><td><p>ERRCODE_DBERR</p></td><td><p>Vishnu not available (Database error)</p></td></tr><tr><td><p>ERRCODE_JOB_IS_NOT_TERMINATED</p></td><td><p>The job is not terminated</p></td></tr><tr><td><p>ERRCODE_SESSIONKEY_EXPIRED</p></td><td><p>The sessionKey is expired. The session is closed.</p></td></tr><tr><td><p>ERRCODE_SESSIONKEY_NOT_FOUND</p></td><td><p>The session key is unrecognized</p></td></tr><tr><td><p>ERRCODE_SSH</p></td><td><p>Vishnu not available (SSH error)</p></td></tr><tr><td><p>ERRCODE_SYSTEM</p></td><td><p>Vishnu not available (System)</p></td></tr><tr><td><p>ERRCODE_UNDEFINED</p></td><td><p>Internal Error: Undefined exception</p></td></tr><tr><td><p>ERRCODE_UNKNOWN_MACHINE</p></td><td><p>The machine id is unknown</p></td></tr><tr><td><p>ERRCODE_UNKNOWN_JOBID</p></td><td><p>The job id is unknown</p></td></tr><tr><td><p>ERRCODE_UNKNOWN_SESSION_ID</p></td><td><p>The session Id is unknown</p></td></tr></tbody></table></div><p><span class="bold"><strong>Used by this(these) API function(s): </strong></span></p><p>TMS::getJobOutput</p></div><div class="section" title="Service jobOutputGetCompletedJobs_MACHINEID"><div class="titlepage"><div><div><h3 class="title"><a id="idp287632"></a>Service jobOutputGetCompletedJobs_MACHINEID</h3></div></div></div><p><span class="bold"><strong>Access</strong></span></p><p>This service can be used by any VISHNU user</p><p><span class="bold"><strong>Parameters</strong></span></p><div class="informaltable"><table border="1"><colgroup><col width="2cm" /><col width="2cm" /><col width="3cm" /><col width="8cm" /><col width="1cm" /></colgroup><thead><tr><th>Parameter</th><th>Type</th><th>Serialized type</th><th>Description</th><th>Mode</th></tr></thead><tbody><tr><td><p>sessionKey</p></td><td><p>string</p></td><td><p>n/a</p></td><td><p> The session key  is the encrypted identifier of the session generated by VISHNU</p></td><td><p>IN</p></td></tr><tr><td><p>machineId</p></td><td><p>string</p></td><td><p>n/a</p></td><td><p>Is the id of the machine on which  the jobs are been submitted</p></td><td><p>IN</p></td></tr><tr><td><p>listOfResults</p></td><td><p>string</p></td><td><p><a class="link" href="#">ListJobResults</a></p></td><td><p>Is the list of jobs results</p></td><td><p>OUT</p></td></tr><tr><td><p>errorInfo</p></td><td><p>string</p></td><td><p>n/a</p></td><td><p>Additional information provided when an error code is returned</p></td><td><p>OUT</p></td></tr><tr><td><p>containerId</p></td><td><p>char*</p></td><td><p>n/a</p></td><td><p>Is the identifier of the diet container which contains the completed jobs output and error paths</p></td><td><p>OUT</p></td></tr></tbody></table></div><p><span class="bold"><strong>Description </strong></span></p><p>The jobOutputGetCompletedJobs_MACHINEID() function dynamically gets outputPath and errorPath of completed jobs of the machine identified by MACHINEID</p><p><span class="bold"><strong>Return Value </strong></span></p><p>An error code is returned when an error occurs during the execution of the service</p><div class="informaltable"><table border="1"><colgroup><col width="8.5cm" /><col width="9cm" /></colgroup><thead><tr><th>Name
</th><th>Description
</th></tr></thead><tbody><tr><td><p>VISHNU_OK</p></td><td><p>The service was performed  successfully</p></td></tr><tr><td><p>ERRCODE_DBCONN</p></td><td><p>Vishnu not available (Database connection)</p></td></tr><tr><td><p>ERRCODE_DBERR</p></td><td><p>Vishnu not available (Database error)</p></td></tr><tr><td><p>ERRCODE_DIET</p></td><td><p>Vishnu not available (Service bus failure)</p></td></tr><tr><td><p>ERRCODE_SSH</p></td><td><p>Vishnu not available (SSH error)</p></td></tr><tr><td><p>ERRCODE_SYSTEM</p></td><td><p>Vishnu not available (System)</p></td></tr><tr><td><p>ERRCODE_UNDEFINED</p></td><td><p>Internal Error: Undefined exception</p></td></tr><tr><td><p>ERRCODE_UNKNOWN_MACHINE</p></td><td><p>The machine id is unknown</p></td></tr><tr><td><p>ERRCODE_UNKNOWN_SESSION_ID</p></td><td><p>The session Id is unknown</p></td></tr></tbody></table></div><p><span class="bold"><strong>Used by this(these) API function(s): </strong></span></p><p>TMS::getCompletedJobsOutput</p></div><div class="section" title="Service jobSubmit_autom"><div class="titlepage"><div><div><h3 class="title"><a id="idp311688"></a>Service jobSubmit_autom</h3></div></div></div><p><span class="bold"><strong>Access</strong></span></p><p>This service can be used by any VISHNU user</p><p><span class="bold"><strong>Parameters</strong></span></p><div class="informaltable"><table border="1"><colgroup><col width="2cm" /><col width="2cm" /><col width="3cm" /><col width="8cm" /><col width="1cm" /></colgroup><thead><tr><th>Parameter</th><th>Type</th><th>Serialized type</th><th>Description</th><th>Mode</th></tr></thead><tbody><tr><td><p>sessionKey</p></td><td><p>string</p></td><td><p>n/a</p></td><td><p>The session key  is the encrypted identifier of the session generated by VISHNU</p></td><td><p>IN</p></td></tr><tr><td><p>autom</p></td><td><p>string</p></td><td><p>n/a</p></td><td><p>The keyword used to submit automatically a job</p></td><td><p>IN</p></td></tr><tr><td><p>scriptContent</p></td><td><p>string</p></td><td><p>n/a</p></td><td><p>Is the content of the script  to  submit</p></td><td><p>IN</p></td></tr><tr><td><p>options</p></td><td><p>string</p></td><td><p><a class="link" href="#">SubmitOptions</a></p></td><td><p>Is an instance of the class SubmitOptions. It allows the user to submit job by using different options</p></td><td><p>IN</p></td></tr><tr><td><p>job</p></td><td><p>string</p></td><td><p><a class="link" href="#">Job</a></p></td><td><p>The  Job object containing the input information (ex: jobPath) and output information (ex:  jobId) of the job to submit</p></td><td><p>INOUT</p></td></tr><tr><td><p>errorInfo</p></td><td><p>string</p></td><td><p>n/a</p></td><td><p>Additional information provided when an error code is returned</p></td><td><p>OUT</p></td></tr></tbody></table></div><p><span class="bold"><strong>Description </strong></span></p><p>The jobSubmit_autom() function submits a job automatically on a best machine (for now three criterions are used: minimum number of waiting jobs, minimum number of running jobs and the total number of jobs) through the use of a script (scriptFilePath) which must be generic script  using  VISHNU's generic directives for all batch schedulers</p><p><span class="bold"><strong>Return Value </strong></span></p><p>An error code is returned when an error occurs during the execution of the service</p><div class="informaltable"><table border="1"><colgroup><col width="8.5cm" /><col width="9cm" /></colgroup><thead><tr><th>Name
</th><th>Description
</th></tr></thead><tbody><tr><td><p>VISHNU_OK</p></td><td><p>The service was performed  successfully</p></td></tr><tr><td><p>ERRCODE_INVALID_PARAM</p></td><td><p>Error invalid parameters</p></td></tr><tr><td><p>ERRCODE_SESSIONKEY_EXPIRED</p></td><td><p>The sessionKey is expired. The session is closed.</p></td></tr><tr><td><p>ERRCODE_SESSIONKEY_NOT_FOUND</p></td><td><p>The session key is unrecognized</p></td></tr><tr><td><p>ERRCODE_BATCH_SCHEDULER_ERROR</p></td><td><p>The batch scheduler indicates an error</p></td></tr><tr><td><p>ERRCODE_SSH</p></td><td><p>Vishnu not available (SSH error)</p></td></tr><tr><td><p>ERRCODE_SYSTEM</p></td><td><p>Vishnu not available (System)</p></td></tr><tr><td><p>ERRCODE_UNDEFINED</p></td><td><p>Internal Error: Undefined exception</p></td></tr><tr><td><p>ERRCODE_UNKNOWN_SESSION_ID</p></td><td><p>The session Id is unknown</p></td></tr><tr><td><p>ERRCODE_DIET</p></td><td><p>Vishnu not available (Service bus failure)</p></td></tr><tr><td><p>ERRCODE_DBERR</p></td><td><p>Vishnu not available (Database error)</p></td></tr><tr><td><p>ERRCODE_DBCONN</p></td><td><p>Vishnu not available (Database connection)</p></td></tr></tbody></table></div><p><span class="bold"><strong>Used by this(these) API function(s): </strong></span></p><p>TMS::submitJob</p></div><div class="section" title="Service getListOfJobs_all"><div class="titlepage"><div><div><h3 class="title"><a id="idp340104"></a>Service getListOfJobs_all</h3></div></div></div><p><span class="bold"><strong>Access</strong></span></p><p>This service can be used by any VISHNU user</p><p><span class="bold"><strong>Parameters</strong></span></p><div class="informaltable"><table border="1"><colgroup><col width="2cm" /><col width="2cm" /><col width="3cm" /><col width="8cm" /><col width="1cm" /></colgroup><thead><tr><th>Parameter</th><th>Type</th><th>Serialized type</th><th>Description</th><th>Mode</th></tr></thead><tbody><tr><td><p>sessionKey</p></td><td><p>string</p></td><td><p>n/a</p></td><td><p> The session key is the encrypted identifier of the session generated by VISHNU</p></td><td><p>IN</p></td></tr><tr><td><p>all</p></td><td><p>string</p></td><td><p>n/a</p></td><td><p>The keyword used to list jobs on all machines</p></td><td><p>IN</p></td></tr><tr><td><p>options</p></td><td><p>string</p></td><td><p><a class="link" href="#">ListJobsOptions</a></p></td><td><p>Additional options for jobs listing</p></td><td><p>IN</p></td></tr><tr><td><p>listOfJobs</p></td><td><p>string</p></td><td><p><a class="link" href="#">ListJobs</a></p></td><td><p>The constructed object list of jobs</p></td><td><p>OUT</p></td></tr><tr><td><p>errorInfo</p></td><td><p>string</p></td><td><p>n/a</p></td><td><p>Additional information provided when an error code is returned</p></td><td><p>OUT</p></td></tr></tbody></table></div><p><span class="bold"><strong>Description </strong></span></p><p>The getListOfJobs_all() function allows to list the submitted jobs on all machines</p><p><span class="bold"><strong>Return Value </strong></span></p><p>An error code is returned when an error occurs during the execution of the service</p><div class="informaltable"><table border="1"><colgroup><col width="8.5cm" /><col width="9cm" /></colgroup><thead><tr><th>Name
</th><th>Description
</th></tr></thead><tbody><tr><td><p>VISHNU_OK</p></td><td><p>The service was performed  successfully</p></td></tr><tr><td><p>ERRCODE_UNKNOWN_SESSION_ID</p></td><td><p>The session Id is unknown</p></td></tr><tr><td><p>ERRCODE_BATCH_SCHEDULER_ERROR</p></td><td><p>The batch scheduler indicates an error</p></td></tr><tr><td><p>ERRCODE_DBCONN</p></td><td><p>Vishnu not available (Database connection)</p></td></tr><tr><td><p>ERRCODE_DBERR</p></td><td><p>Vishnu not available (Database error)</p></td></tr><tr><td><p>ERRCODE_DIET</p></td><td><p>Vishnu not available (Service bus failure)</p></td></tr><tr><td><p>ERRCODE_SYSTEM</p></td><td><p>Vishnu not available (System)</p></td></tr><tr><td><p>ERRCODE_UNDEFINED</p></td><td><p>Internal Error: Undefined exception</p></td></tr><tr><td><p>ERRCODE_SESSIONKEY_NOT_FOUND</p></td><td><p>The session key is unrecognized</p></td></tr><tr><td><p>ERRCODE_SESSIONKEY_EXPIRED</p></td><td><p>The sessionKey is expired. The session is closed.</p></td></tr></tbody></table></div><p><span class="bold"><strong>Used by this(these) API function(s): </strong></span></p><p>TMS::listJobs</p></div></div></div><div class="chapter" title="Chapter 4. Internal class and data structures"><div class="titlepage"><div><div><h2 class="title"><a id="idp365152"></a>Chapter 4. Internal class and data structures</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#idp365512">Introduction</a></span></dt><dt><span class="section"><a href="#idp370304">TMS client modelization</a></span></dt><dd><dl><dt><span class="section"><a href="#idp370824">Class diagrams</a></span></dt></dl></dd><dt><span class="section"><a href="#idp373496">TMS server modelization</a></span></dt><dd><dl><dt><span class="section"><a href="#idp374016">Class diagrams</a></span></dt></dl></dd><dt><span class="section"><a href="#idp376568">TMS data modelization</a></span></dt><dd><dl><dt><span class="section"><a href="#idp377088">Class diagrams</a></span></dt></dl></dd></dl></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp365512"></a>Introduction</h2></div></div></div><p>This chapter introduces the details of the implementation of the different components described in chapter 2 (Architecture).
        It is composed of three sections:
      </p><p>
        </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="bold"><strong>Client modelization</strong></span>: describes the classes used to implement the 
              <span class="it">TMS Client</span> component.</p></li><li class="listitem"><p><span class="bold"><strong>Server modelization</strong></span>: describes the classes used to implement the 
              <span class="it">TMS Server</span> component.</p></li><li class="listitem"><p><span class="bold"><strong>Data modelization</strong></span>: describes the data structure used to implement the 
              <span class="it">TMS Client</span> component and the <span class="it">TMS Server</span> component.</p></li></ul></div><p>
      </p></div><div class="section" title="TMS client modelization"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp370304"></a>TMS client modelization</h2></div></div></div><div class="section" title="Class diagrams"><div class="titlepage"><div><div><h3 class="title"><a id="idp370824"></a>Class diagrams</h3></div></div></div><div class="section" title="TMS Client Class Diagram"><div class="titlepage"><div><div><h4 class="title"><a id="idp371168"></a>TMS Client Class Diagram</h4></div></div></div><p>This diagram describes all classes used to communicate with VISHNU System. Each class proxy contains the corresponding data class illustrated on the TMS Data modelization section and the methods usable by the TMS Client component.</p><div class="figure"><a id="idp371952"></a><p class="title"><b>Figure 4.1. TMS Client Class Diagram</b></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/png/TMS_Client_Class_Diagram.png" align="middle" alt="TMS Client Class Diagram" /></div></div></div><br class="figure-break" /></div></div></div><div class="section" title="TMS server modelization"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp373496"></a>TMS server modelization</h2></div></div></div><div class="section" title="Class diagrams"><div class="titlepage"><div><div><h3 class="title"><a id="idp374016"></a>Class diagrams</h3></div></div></div><div class="section" title="TMS Server Class Diagram"><div class="titlepage"><div><div><h4 class="title"><a id="idp374360"></a>TMS Server Class Diagram</h4></div></div></div><p>This diagram presents the main objects used by TMS server component to process the TMS Client component requests. </p><div class="figure"><a id="idp375024"></a><p class="title"><b>Figure 4.2. TMS Server Class Diagram</b></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/png/TMS_Server_Class_Diagram.png" align="middle" alt="TMS Server Class Diagram" /></div></div></div><br class="figure-break" /></div></div></div><div class="section" title="TMS data modelization"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp376568"></a>TMS data modelization</h2></div></div></div><div class="section" title="Class diagrams"><div class="titlepage"><div><div><h3 class="title"><a id="idp377088"></a>Class diagrams</h3></div></div></div><div class="section" title="TMS Data Class Diagram"><div class="titlepage"><div><div><h4 class="title"><a id="idp377432"></a>TMS Data Class Diagram</h4></div></div></div><p>This diagram illustrates the structure and the relationship between data manipulated by the components Client and Server. </p><div class="figure"><a id="idp378104"></a><p class="title"><b>Figure 4.3. TMS Data Class Diagram</b></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/png/TMS_Data_Class_Diagram.png" align="middle" alt="TMS Data Class Diagram" /></div></div></div><br class="figure-break" /></div></div></div></div></div></body></html>
